package org.openmrs.module.eptsreports.reporting.library.queries.mq;

import org.openmrs.module.eptsreports.reporting.utils.WomanState;

public interface MQCategory15QueriesInterface {

  class QUERY {

    public static final String findPatientsWhoAreNewlyEnrolledOnARTByAgeBetweenAgeRange(
        int startAge, int endAge) {

      final String sql =
          "SELECT patient_id FROM (                                                                                          "
              + "SELECT patient_id, MIN(art_start_date) art_start_date FROM (                                                               "
              + "SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p                                                     "
              + "INNER JOIN encounter e ON p.patient_id=e.patient_id                                                                        "
              + "INNER JOIN obs o ON e.encounter_id=o.encounter_id                                                                          "
              + "WHERE p.voided=0 AND e.voided=0 AND o.voided=0 AND e.encounter_type=53                                                     "
              + "AND o.concept_id=1190 AND o.value_datetime is NOT NULL AND o.value_datetime<=:endInclusionDate AND e.location_id=:location "
              + "GROUP BY p.patient_id                                                                                               "
              + ") art_start GROUP BY patient_id) tx_new                                                                                    "
              + "INNER JOIN person pe ON tx_new.patient_id=pe.person_id                                                                     "
              + "WHERE (TIMESTAMPDIFF(year,birthdate,art_start_date)) BETWEEN %s AND %s AND birthdate IS NOT NULL and pe.voided = 0         "
              + "AND art_start_date BETWEEN :startInclusionDate AND :endInclusionDate                                                       ";
      return String.format(sql, startAge, endAge);
    }

    public static final String findPatientsFromFichaClinicaForGivenConceptsDenominadorCategoria15A =
        " select patient_id from "
            + "( select p.patient_id,max(e.encounter_datetime) from patient p  "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id  "
            + "join obs o on o.encounter_id=e.encounter_id  "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23724,23730) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0 "
            + "and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 26 MONTH INTERVAL + 1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH) and e.location_id=:location  "
            + "group by p.patient_id "
            + "union "
            + "select max_tipo_despensa.* from (  "
            + "select max_tl.patient_id, max_tl.max_datatl from  ( "
            + "select p.patient_id,max(o.obs_datetime) max_datatl from patient p  "
            + "join encounter e on p.patient_id=e.patient_id   "
            + "join obs o on o.encounter_id=e.encounter_id  "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location "
            + "and DATE(o.obs_datetime) between (:endRevisionDate - INTERVAL 26 MONTH INTERVAL + 1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH) "
            + "group by p.patient_id "
            + ") max_tl  "
            + "join obs on obs.person_id=max_tl.patient_id and max_tl.max_datatl=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded=23720 and obs.voided=0 and obs.location_id=:location "
            + ") max_tipo_despensa  "
            + ") result ";

    public static final String
        findPatientsFromFichaClinicaForGivenConceptsDenominadorCategoria15ARF5 =
            "select patient_id from ( "
                + "select p.patient_id,max(e.encounter_datetime) data_mdc from patient p "
                + "join encounter e on p.patient_id=e.patient_id "
                + "join obs grupo on grupo.encounter_id=e.encounter_id "
                + "join obs o on o.encounter_id=e.encounter_id "
                + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
                + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23724,23730,165179,165315,23888,23729,165314) and o.voided=0 "
                + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0 "
                + "and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  and e.location_id=:location "
                + "group by p.patient_id "
                + "union "
                + "select max_tipo_despensa.patient_id,max_tipo_despensa.data_mdc from   ( "
                + "select max_tl.patient_id, max_tl.data_mdc from   ( "
                + "select p.patient_id,max(o.obs_datetime) data_mdc from patient p "
                + "join encounter e on p.patient_id=e.patient_id "
                + "join obs o on o.encounter_id=e.encounter_id "
                + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location "
                + "and DATE(o.obs_datetime) between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH) "
                + "group by p.patient_id "
                + ") max_tl "
                + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime "
                + "where obs.concept_id=23739 and obs.value_coded in(23720,23888,165314) and obs.voided=0 and obs.location_id=:location "
                + ") max_tipo_despensa "
                + "union "
                + "select f.patient_id,f.data_levantamento data_mdc from "
                + "( "
                + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from "
                + "( "
                + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
                + "inner join encounter e on e.patient_id=p.patient_id "
                + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
                + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH) "
                + "group by p.patient_id "
                + ")fila "
                + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
                + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
                + "and obs_fila.concept_id=5096 "
                + "and obs_fila.location_id=:location "
                + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97) "
                + "group by fila.patient_id "
                + ") f "
                + "union "
                + "select f.patient_id,f.data_levantamento data_mdc from "
                + "( "
                + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
                + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
                + "inner join encounter e on e.patient_id=p.patient_id "
                + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
                + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH) "
                + "group by p.patient_id "
                + ")fila "
                + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
                + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
                + "and obs_fila.concept_id=5096 "
                + "and obs_fila.location_id=:location "
                + "where (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 173 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 187) "
                + "group by fila.patient_id "
                + ") f "
                + "union "
                + "select f.patient_id,f.data_levantamento data_mdc from "
                + "( "
                + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
                + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
                + "inner join encounter e on e.patient_id=p.patient_id "
                + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
                + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH) "
                + "group by p.patient_id "
                + ")fila "
                + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
                + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
                + "and obs_fila.concept_id=5096 "
                + "and obs_fila.location_id=:location "
                + "where (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 335 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 395) "
                + "group by fila.patient_id "
                + ") f "
                + ") result ";

    public static final String findPatientsWhoHaveLastConsultationOnFichaClinicaAndWhoOnMDCARF44 =
        "select patient_id from ( "
            + "select patient_id from ( "
            + "select maxEnc.patient_id,mdc.data_mdc  from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + " inner join ( "
            + "select p.patient_id,max(e.encounter_datetime) data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23724,23730,165179,165315,23888,23729,165314) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id "
            + "group by p.patient_id "
            + ")mdc on mdc.patient_id = maxEnc.patient_id "
            + "where mdc.data_mdc<maxEnc.data "
            + ") mdc "
            + "group by mdc.patient_id "
            + "union "
            + "select patient_id from( "
            + "select maxEnc.patient_id,max(td.data_mdc) data_mdc from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join( "
            + "select p.patient_id,o.obs_datetime data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location "
            + ") td on td.patient_id = maxEnc.patient_id "
            + "where td.data_mdc<maxEnc.data "
            + "group by maxEnc.patient_id "
            + ") tipodispensa "
            + "inner join obs on obs.person_id=tipodispensa.patient_id and tipodispensa.data_mdc=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded in(23720,23888,165314) and obs.voided=0 and obs.location_id=:location "
            + "union "
            + "select patient_id from ( "
            + "select maxEnc.patient_id, max(fila.data_levantamento) data_levantamento from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join( "
            + "Select p.patient_id,encounter_datetime data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + ")fila on fila.patient_id =  maxEnc.patient_id "
            + "where fila.data_levantamento<maxEnc.data "
            + "group by maxEnc.patient_id "
            + ") fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=5096 "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97) "
            + "union "
            + "select patient_id from ( "
            + "select maxEnc.patient_id, max(fila.data_levantamento) data_levantamento from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join( "
            + "Select p.patient_id,encounter_datetime data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + ")fila on fila.patient_id =  maxEnc.patient_id "
            + "where fila.data_levantamento<maxEnc.data "
            + "group by maxEnc.patient_id "
            + ") fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=5096 "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 173 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 187) "
            + "union "
            + "select patient_id from ( "
            + "select maxEnc.patient_id, max(fila.data_levantamento) data_levantamento from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join( "
            + "Select p.patient_id,encounter_datetime data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + ")fila on fila.patient_id =  maxEnc.patient_id "
            + "where fila.data_levantamento<maxEnc.data "
            + "group by maxEnc.patient_id "
            + ") fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=5096 "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 335 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 395) "
            + ") final group by patient_id ";

    public static final String findPatientsWhoHaveLastConsultationOnFichaClinicaAndWhoOnMDCRF36 =
        "select patient_id from ( "
            + "select maxEnc.patient_id from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select p.patient_id,max(e.encounter_datetime) data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23724,23730,165179,165315,23888,23729,165314) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256)  and obsEstado.voided=0  and grupo.voided=0 "
            + "and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate  and e.location_id=:location "
            + "group by p.patient_id "
            + ") mdc on mdc.patient_id = maxEnc.patient_id "
            + "where mdc.data_mdc=maxEnc.data "
            + "union "
            + "select maxEnc.patient_id from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select max_tipo_despensa.patient_id,max_tipo_despensa.data_mdc from   ( "
            + "select max_tl.patient_id, max_tl.data_mdc from   ( "
            + "select p.patient_id,max(o.obs_datetime) data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location "
            + "and DATE(o.obs_datetime) between (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate "
            + "group by p.patient_id "
            + ") max_tl "
            + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded in(23720,23888,165314) and obs.voided=0 and obs.location_id=:location "
            + ") max_tipo_despensa "
            + ") td on td.patient_id = maxEnc.patient_id "
            + "where td.data_mdc=maxEnc.data "
            + "union "
            + "select maxEnc.patient_id from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select f.patient_id,f.data_levantamento data_mdc from   ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=5096 "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97) "
            + "group by fila.patient_id "
            + ") f "
            + ") dt on dt.patient_id = maxEnc.patient_id "
            + "union "
            + "select maxEnc.patient_id from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select f.patient_id,f.data_levantamento data_mdc from  ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=5096 "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 173 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 187) "
            + "group by fila.patient_id "
            + ") f "
            + ") ds on ds.patient_id = maxEnc.patient_id "
            + "union "
            + "select maxEnc.patient_id from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select f.patient_id,f.data_levantamento data_mdc from  ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=5096 "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 335 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 395) "
            + "group by fila.patient_id "
            + ") f "
            + ") da on da.patient_id = maxEnc.patient_id "
            + ") result group by result.patient_id ";

    public static final String
        findPatientsFromFichaClinicaForGivenConceptsDenominadorCategoria15ARF6 =
            "select result.patient_id from  ( "
                + "select p.patient_id,max(e.encounter_datetime) as data_mdc from patient p   "
                + "join encounter e on p.patient_id=e.patient_id  "
                + "join obs grupo on grupo.encounter_id=e.encounter_id   "
                + "join obs o on o.encounter_id=e.encounter_id   "
                + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
                + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(%d) and o.voided=0  "
                + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0  "
                + "and DATE(e.encounter_datetime) between (:endRevisionDate  - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate  - INTERVAL 24 MONTH) and e.location_id=:location   "
                + "group by p.patient_id  "
                + "union "
                + "select max_tipo_despensa.patient_id, max_tipo_despensa.data_mdc  from  "
                + "(   "
                + "select max_tl.patient_id,max_tl.data_mdc from   (  "
                + "select p.patient_id,max(o.obs_datetime) as data_mdc from patient p   "
                + "join encounter e on p.patient_id=e.patient_id    "
                + "join obs o on o.encounter_id=e.encounter_id   "
                + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location  "
                + "and DATE(o.obs_datetime) between (:endRevisionDate  - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate  - INTERVAL 24 MONTH)  "
                + "group by p.patient_id  "
                + ") max_tl   "
                + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime  "
                + "where obs.concept_id=23739 and obs.value_coded=23720 and obs.voided=0 and obs.location_id=:location  "
                + ") max_tipo_despensa   "
                + "union  "
                + "select f.patient_id,f.data_levantamento as data_mdc from  (   "
                + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  (   "
                + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p  "
                + "inner join encounter e on e.patient_id=p.patient_id   "
                + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
                + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)   "
                + "group by p.patient_id  "
                + ")fila   "
                + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id  "
                + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento   "
                + "and obs_fila.concept_id=5096   "
                + "and obs_fila.location_id=:location "
                + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97)   "
                + "group by fila.patient_id   "
                + ") f "
                + ") result ";

    public static final String findPatientsOnDMCWhoHaveTwoVLRequestAndOneVLResultWhoOnDT =
        "select result.patient_id from  "
            + "( "
            + "select p.patient_id,max(e.encounter_datetime) as data_mdc from patient p   "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id   "
            + "join obs o on o.encounter_id=e.encounter_id   "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type in(6,9) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(%d) and o.voided=0  "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0  "
            + "and DATE(e.encounter_datetime) between (:endRevisionDate  - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate  - INTERVAL 24 MONTH) and e.location_id=:location   "
            + "group by p.patient_id  "
            + "union "
            + "select max_tipo_despensa.patient_id, max_tipo_despensa.data_mdc  from  (   "
            + "select max_tl.patient_id,max_tl.data_mdc from   (  "
            + "select p.patient_id,max(o.obs_datetime) as data_mdc from patient p   "
            + "join encounter e on p.patient_id=e.patient_id    "
            + "join obs o on o.encounter_id=e.encounter_id   "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location  "
            + "and DATE(o.obs_datetime) between (:endRevisionDate  - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate  - INTERVAL 24 MONTH)  "
            + "group by p.patient_id  "
            + ") max_tl   "
            + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime  "
            + "where obs.concept_id=23739 and obs.value_coded=23720 and obs.voided=0 and obs.location_id=:location  "
            + ") max_tipo_despensa   "
            + "union "
            + "select f.patient_id,f.data_levantamento as data_mdc from  (  "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  (  "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  "
            + "group by p.patient_id "
            + ")fila  "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento  "
            + "and obs_fila.concept_id=5096  "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97)  "
            + "group by fila.patient_id  "
            + ") f "
            + ") result  "
            + "inner join ( "
            + "select pedido.patient_id,pedido.data_primeira,pedido.data_segundo_pedido from  "
            + "( "
            + "select distinct cvpedido.patient_id,cvpedido.data_primeira,min(e.encounter_datetime) data_segundo_pedido from   (  "
            + "select  p.patient_id,min(e.encounter_datetime) data_primeira, e.encounter_id from patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id  "
            + "where o.concept_id=23722 and o.value_coded=856   "
            + "and p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=6 and e.encounter_datetime<=:endRevisionDate   "
            + "group by p.patient_id  "
            + ")cvpedido  "
            + "inner join encounter e on e.patient_id=cvpedido.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id  "
            + "and e.encounter_datetime>cvpedido.data_primeira and e.encounter_type=6 and o.concept_id=23722 and e.voided=0 and o.voided=0 "
            + "group by cvpedido.patient_id "
            + ") pedido  "
            + "inner join ( "
            + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
            + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
            + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
            + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
            + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
            + "AND ob.concept_id in (856) AND enc.encounter_type=6 and ob.value_numeric <1000 "
            + "union "
            + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
            + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
            + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
            + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
            + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
            + "AND ob.concept_id in (1305) AND enc.encounter_type=6  "
            + ") cv on pedido.patient_id=cv.patient_id and cv.encounter_datetime > pedido.data_primeira and cv.encounter_datetime<pedido.data_segundo_pedido "
            + ")pedido on pedido.patient_id=result.patient_id  "
            + "where (pedido.data_primeira between result.data_mdc and :endRevisionDate) and (pedido.data_segundo_pedido between result.data_mdc and :endRevisionDate) ";

    public static final String findPatientsOnDMCWhoOnDTAndHaveTwoRequestVLAndVLOnLabForm =
        "select f.patient_id from ( "
            + "select result.patient_id,result.data_mdc,pedido.data_primeira,pedido.data_segundo_pedido from  (     "
            + "select p.patient_id,max(e.encounter_datetime) as data_mdc from patient p   "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id   "
            + "join obs o on o.encounter_id=e.encounter_id   "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(%d) and o.voided=0  "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0  "
            + "and DATE(e.encounter_datetime) between (:endRevisionDate  - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate  - INTERVAL 24 MONTH) and e.location_id=:location   "
            + "group by p.patient_id  "
            + "union "
            + "select max_tipo_despensa.patient_id, max_tipo_despensa.data_mdc  from  (   "
            + "select max_tl.patient_id,max_tl.data_mdc from   (  "
            + "select p.patient_id,max(o.obs_datetime) as data_mdc from patient p   "
            + "join encounter e on p.patient_id=e.patient_id    "
            + "join obs o on o.encounter_id=e.encounter_id   "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location  "
            + "and DATE(o.obs_datetime) between (:endRevisionDate  - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate  - INTERVAL 24 MONTH)  "
            + "group by p.patient_id  "
            + ") max_tl   "
            + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime  "
            + "where obs.concept_id=23739 and obs.value_coded=23720 and obs.voided=0 and obs.location_id=:location  "
            + ") max_tipo_despensa   "
            + "union "
            + "select f.patient_id,f.data_levantamento as data_mdc from  (  "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  (  "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  "
            + "group by p.patient_id "
            + ")fila  "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento  "
            + "and obs_fila.concept_id=5096  "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97)  "
            + "group by fila.patient_id  "
            + ") f "
            + ") result  "
            + "inner join ( "
            + "select pedido.patient_id,pedido.data_primeira,pedido.data_segundo_pedido from  ( "
            + "select distinct cvpedido.patient_id,cvpedido.data_primeira,min(e.encounter_datetime) data_segundo_pedido from   (  "
            + "select  p.patient_id,min(e.encounter_datetime) data_primeira, e.encounter_id from patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id  "
            + "where o.concept_id=23722 and o.value_coded=856   "
            + "and p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=6 and e.encounter_datetime<=:endRevisionDate   "
            + "group by p.patient_id  "
            + ")cvpedido  "
            + "inner join encounter e on e.patient_id=cvpedido.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id  "
            + "and e.encounter_datetime>cvpedido.data_primeira and e.encounter_type=6 and o.concept_id=23722 and e.voided=0 and o.voided=0 "
            + "group by cvpedido.patient_id "
            + ") pedido  "
            + "inner join ( "
            + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
            + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
            + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
            + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
            + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
            + "AND ob.concept_id in (856) AND enc.encounter_type=6 and ob.value_numeric <=1000 "
            + "union "
            + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
            + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
            + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
            + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
            + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
            + "AND ob.concept_id in (1305) AND enc.encounter_type=6  "
            + ") cv on pedido.patient_id=cv.patient_id and cv.encounter_datetime > pedido.data_primeira and cv.encounter_datetime<pedido.data_segundo_pedido "
            + ")pedido on pedido.patient_id=result.patient_id  "
            + "where (pedido.data_primeira between result.data_mdc and :endRevisionDate) and (pedido.data_segundo_pedido between result.data_mdc and :endRevisionDate )  "
            + ")f "
            + "inner join ( "
            + "select p.patient_id,e.encounter_datetime from patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=13 and o.concept_id in(856,1305) and p.voided=0 and e.voided=0 and o.voided=0 "
            + ") cvLab on f.patient_id=cvLab.patient_id "
            + "where cvLab.encounter_datetime between f.data_segundo_pedido and :endRevisionDate ";

    public static final String
        findPatientsOnDMCWhoOnDTAndHaveTwoRequestVLAndVLOnLabFormOverThan1000 =
            "select f.patient_id from ( "
                + "select result.patient_id,result.data_mdc,pedido.data_primeira,pedido.data_segundo_pedido from  (     "
                + "select p.patient_id,max(e.encounter_datetime) as data_mdc from patient p   "
                + "join encounter e on p.patient_id=e.patient_id  "
                + "join obs grupo on grupo.encounter_id=e.encounter_id   "
                + "join obs o on o.encounter_id=e.encounter_id   "
                + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
                + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(%d) and o.voided=0  "
                + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0  "
                + "and DATE(e.encounter_datetime) between (:endRevisionDate  - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate  - INTERVAL 24 MONTH) and e.location_id=:location   "
                + "group by p.patient_id  "
                + "union "
                + "select max_tipo_despensa.patient_id, max_tipo_despensa.data_mdc  from  (   "
                + "select max_tl.patient_id,max_tl.data_mdc from   (  "
                + "select p.patient_id,max(o.obs_datetime) as data_mdc from patient p   "
                + "join encounter e on p.patient_id=e.patient_id    "
                + "join obs o on o.encounter_id=e.encounter_id   "
                + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location  "
                + "and DATE(o.obs_datetime) between (:endRevisionDate  - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate  - INTERVAL 24 MONTH)  "
                + "group by p.patient_id  "
                + ") max_tl   "
                + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime  "
                + "where obs.concept_id=23739 and obs.value_coded=23720 and obs.voided=0 and obs.location_id=:location  "
                + ") max_tipo_despensa   "
                + "union "
                + "select f.patient_id,f.data_levantamento as data_mdc from  (  "
                + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  (  "
                + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
                + "inner join encounter e on e.patient_id=p.patient_id  "
                + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
                + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  "
                + "group by p.patient_id "
                + ")fila  "
                + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
                + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento  "
                + "and obs_fila.concept_id=5096  "
                + "and obs_fila.location_id=:location "
                + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97)  "
                + "group by fila.patient_id  "
                + ") f "
                + ") result  "
                + "inner join ( "
                + "select pedido.patient_id,pedido.data_primeira,pedido.data_segundo_pedido from  ( "
                + "select distinct cvpedido.patient_id,cvpedido.data_primeira,min(e.encounter_datetime) data_segundo_pedido from   (  "
                + "select  p.patient_id,min(e.encounter_datetime) data_primeira, e.encounter_id from patient p "
                + "inner join encounter e on e.patient_id=p.patient_id  "
                + "inner join obs o on o.encounter_id=e.encounter_id  "
                + "where o.concept_id=23722 and o.value_coded=856   "
                + "and p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=6 and e.encounter_datetime<=:endRevisionDate   "
                + "group by p.patient_id  "
                + ")cvpedido  "
                + "inner join encounter e on e.patient_id=cvpedido.patient_id "
                + "inner join obs o on o.encounter_id=e.encounter_id  "
                + "and e.encounter_datetime>cvpedido.data_primeira and e.encounter_type=6 and o.concept_id=23722 and e.voided=0 and o.voided=0 "
                + "group by cvpedido.patient_id "
                + ") pedido  "
                + "inner join ( "
                + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
                + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
                + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
                + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
                + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
                + "AND ob.concept_id in (856) AND enc.encounter_type=6 and ob.value_numeric <=1000 "
                + "union "
                + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
                + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
                + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
                + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
                + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
                + "AND ob.concept_id in (1305) AND enc.encounter_type=6  "
                + ") cv on pedido.patient_id=cv.patient_id and cv.encounter_datetime > pedido.data_primeira and cv.encounter_datetime<pedido.data_segundo_pedido "
                + ")pedido on pedido.patient_id=result.patient_id  "
                + "where (pedido.data_primeira between result.data_mdc and :endRevisionDate) and (pedido.data_segundo_pedido between result.data_mdc and :endRevisionDate )  "
                + ")f "
                + "inner join ( "
                + "select p.patient_id,e.encounter_datetime from patient p "
                + "inner join encounter e on e.patient_id=p.patient_id "
                + "inner join obs o on o.encounter_id=e.encounter_id "
                + "where e.encounter_type=13 and o.concept_id=856 and p.voided=0 and e.voided=0 and o.voided=0 and e.location_id=:location and o.value_numeric < 1000 "
                + "union "
                + "select p.patient_id,e.encounter_datetime from patient p "
                + "inner join encounter e on e.patient_id=p.patient_id "
                + "inner join obs o on o.encounter_id=e.encounter_id "
                + "where e.encounter_type=13 and o.concept_id=1305 and p.voided=0 and e.voided=0 and o.voided=0 and e.location_id=:location "
                + ") cvLab on f.patient_id=cvLab.patient_id "
                + "where (cvLab.encounter_datetime between f.data_segundo_pedido and :endRevisionDate) ";

    public static final String findPatientsWhoHaveCD4OverThan1000 =
        "select cd4.patient_id from (  "
            + "Select p.patient_id, o.obs_datetime as data_cd4, o.value_numeric  "
            + "From patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on e.encounter_id=o.encounter_id  "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id = 1695 and  e.encounter_type = 6 and o.value_numeric<=200 and e.location_id=:location and e.encounter_datetime <=:endRevisionDate "
            + "group by p.patient_id  "
            + ")cd4  "
            + "left join( "
            + "Select p.patient_id, e.encounter_datetime as data_cv  "
            + "From patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on e.encounter_id=o.encounter_id  "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id in(856,1305) and  e.encounter_type = 6  and e.location_id=:location and e.encounter_datetime <=:endRevisionDate "
            + "group by p.patient_id  "
            + ")cv on cv.patient_id=cd4.patient_id  "
            + "where cv.patient_id is null ";

    public static final String findPatientsWhoHaveCVBiggerThan1000 =
        "select cv.patient_id from (  "
            + "Select p.patient_id, max(e.encounter_datetime) as data_cv  "
            + "From patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on e.encounter_id=o.encounter_id  "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id in(856) and  e.encounter_type = 6  "
            + "and e.location_id=:location and e.encounter_datetime <=:endRevisionDate  and o.value_numeric >=1000 "
            + "group by p.patient_id "
            + ")cv ";

    public static final String findPatientsWhoOnARTAndHaveCVBiggerThan1000AndWhoSuspendTratment =
        "select result.patient_id from ( "
            + "select cv.patient_id, max(clinica.data_consulta) data_consulta from "
            + "( "
            + "select maxEnc.patient_id,maxEnc.data_ultima_consulta, cvLab.data_cv,cvLab.valor from  ( "
            + "select p.patient_id, max(e.encounter_datetime) data_ultima_consulta FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime  between  (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id=:location "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join ( "
            + "select p.patient_id,e.encounter_datetime data_cv,o.value_numeric valor from patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and o.concept_id=856 and p.voided=0 and e.voided=0 and o.voided=0 and o.value_numeric>=1000 "
            + ") cvLab on maxEnc.patient_id=cvLab.patient_id "
            + "where maxEnc.data_ultima_consulta=cvLab.data_cv "
            + ")cv "
            + "inner join ( "
            + "select clinica.patient_id,clinica.data_consulta,obs_proxima.value_datetime data_proxima_consulta  from  ( "
            + "Select p.patient_id,encounter_datetime data_consulta  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=6 and e.location_id=:location "
            + ")clinica "
            + "inner join  obs obs_proxima on obs_proxima.person_id=clinica.patient_id "
            + "and obs_proxima.voided=0  and obs_proxima.obs_datetime=clinica.data_consulta "
            + "and obs_proxima.concept_id=1410 "
            + "and obs_proxima.location_id=:location "
            + ")clinica "
            + "where  (clinica.data_consulta>=cv.data_ultima_consulta and clinica.data_consulta<=:endRevisionDate ) and (DATEDIFF(clinica.data_proxima_consulta,clinica.data_consulta) >= 23) "
            + "and (DATEDIFF(clinica.data_proxima_consulta,clinica.data_consulta) <=37) and cv.patient_id = clinica.patient_id "
            + "group by  cv.patient_id "
            + ")result ";

    public static final String
        findPatientsWithLastGaacOrLastDispensaTrimestralRegisteredInFichaClinicaWithinRevisionPeriodB1 =
            "select patient_id from(																											"
                + "		 select max_fim_gaac.patient_id, max_fim_gaac.max_fim from (              													"
                + "		 	select p.patient_id,max(o.obs_datetime) max_fim 																		"
                + "		 	from patient p              																							"
                + "		 		join encounter e on p.patient_id=e.patient_id              															"
                + "		 		join obs o on o.encounter_id=e.encounter_id              															"
                + "		 	where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 													"
                + "		 		and o.concept_id=23724 and e.location_id=:location 																	"
                + "		 		and o.obs_datetime <= :endRevisionDate group by p.patient_id) max_fim_gaac 											"
                + "		 	join obs on obs.person_id=max_fim_gaac.patient_id and max_fim_gaac.max_fim=obs.obs_datetime              				"
                + "		 	where obs.concept_id=23724 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location 						"
                + "		 union																														"
                + "		 select max_dispensa_trimestral.patient_id, max_dispensa_trimestral.max_fim from (              							"
                + "		 	select p.patient_id,max(o.obs_datetime) max_fim 																		"
                + "		 	from patient p              																							"
                + "		 		join encounter e on p.patient_id=e.patient_id              															"
                + "		 		join obs o on o.encounter_id=e.encounter_id              															"
                + "		 	where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 													"
                + "		 		and o.concept_id=23730 and e.location_id=:location 																	"
                + "		 		and o.obs_datetime <=:endRevisionDate group by p.patient_id) max_dispensa_trimestral   								"
                + "		 	join obs on obs.person_id=max_dispensa_trimestral.patient_id and max_dispensa_trimestral.max_fim=obs.obs_datetime  		"
                + "		 	where obs.concept_id=23730 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location        				"
                + "		 	union																													"
                + "		  select max_tipo_dispensa.patient_id, max_tipo_dispensa.max_fim from (              										"
                + "		 	select p.patient_id,max(o.obs_datetime) max_fim 																		"
                + "		 	from patient p              																							"
                + "		 		join encounter e on p.patient_id=e.patient_id              															"
                + "		 		join obs o on o.encounter_id=e.encounter_id              															"
                + "		 	where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 													"
                + "		 		and o.concept_id=23739 and e.location_id=:location 																	"
                + "		 		and o.obs_datetime <= :endRevisionDate group by p.patient_id) max_tipo_dispensa   									"
                + "		 	join obs on obs.person_id=max_tipo_dispensa.patient_id and max_tipo_dispensa.max_fim=obs.obs_datetime  					"
                + "		 	where obs.concept_id=23739 and obs.value_coded <>23720 and obs.voided=0 and obs.location_id=:location) result          	";

    public static final String findPatientsWithDTandGaacWithRequestForVLCategory15H1 =
        " select dtFinal.patient_id from "
            + " ( "
            + " select patient_id,max(encounter_datetime) dataDT "
            + " from ( "
            + " select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p  "
            + " join encounter e on p.patient_id=e.patient_id "
            + " join obs grupo on grupo.encounter_id=e.encounter_id  "
            + " join obs o on o.encounter_id=e.encounter_id  "
            + " join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + " where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23724,23730) and o.voided=0 "
            + " and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0 "
            + " and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH) and e.location_id=:location  "
            + " group by p.patient_id "
            + " union "
            + " select max_tl.patient_id, max_tl.max_datatl encounter_datetime "
            + " from ( "
            + " select 	p.patient_id,max(o.obs_datetime) max_datatl "
            + " from 	patient p "
            + " join encounter e on p.patient_id=e.patient_id "
            + " join obs o on o.encounter_id=e.encounter_id "
            + " where 	e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 "
            + " and o.concept_id=23739 and e.location_id=:location "
            + " and DATE(o.obs_datetime) between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH) "
            + " group by p.patient_id  "
            + " ) max_tl "
            + " join encounter e on e.patient_id=max_tl.patient_id "
            + " join obs on obs.encounter_id=e.encounter_id "
            + " where 	obs.concept_id=23739 and obs.value_coded=23720 and max_tl.max_datatl=obs.obs_datetime "
            + " and obs.voided=0 and obs.location_id=:location and e.location_id=:location "
            + " and e.voided=0 and e.encounter_type=6 "
            + " ) dt "
            + " group by dt.patient_id "
            + " ) dtFinal "
            + " inner join encounter e on e.patient_id=dtFinal.patient_id "
            + " inner join obs obsPedido on obsPedido.encounter_id=e.encounter_id "
            + " where 	obsPedido.concept_id=23722 and obsPedido.value_coded=856 "
            + " and obsPedido.obs_datetime>=dtFinal.dataDT and obsPedido.obs_datetime<=:endRevisionDate and "
            + " obsPedido.voided=0 and obsPedido.location_id=:location and e.location_id=:location and e.voided=0 and e.encounter_type=6 ";

    public static final String findPatientsWithDTWithRequestForVLCategory15_7_FR20 =
        " select dtFinal.patient_id from "
            + " ( "
            + " select patient_id,max(encounter_datetime) dataDT "
            + " from ( "
            + " select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p  "
            + " join encounter e on p.patient_id=e.patient_id "
            + " join obs grupo on grupo.encounter_id=e.encounter_id  "
            + " join obs o on o.encounter_id=e.encounter_id  "
            + " join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + " where e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23730) and o.voided=0 "
            + " and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0 "
            + " and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH) and e.location_id=:location  "
            + " group by p.patient_id "
            + " union "
            + " select max_tl.patient_id, max_tl.max_datatl encounter_datetime "
            + " from ( "
            + " select 	p.patient_id,max(o.obs_datetime) max_datatl "
            + " from 	patient p "
            + " join encounter e on p.patient_id=e.patient_id "
            + " join obs o on o.encounter_id=e.encounter_id "
            + " where 	e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 "
            + " and o.concept_id=23739 and e.location_id=:location "
            + " and DATE(o.obs_datetime) between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH) "
            + " group by p.patient_id  "
            + " ) max_tl "
            + " join encounter e on e.patient_id=max_tl.patient_id "
            + " join obs on obs.encounter_id=e.encounter_id "
            + " where 	obs.concept_id=23739 and obs.value_coded=23720 and max_tl.max_datatl=obs.obs_datetime "
            + " and obs.voided=0 and obs.location_id=:location and e.location_id=:location "
            + " and e.voided=0 and e.encounter_type=6 "
            + " ) dt "
            + " group by dt.patient_id "
            + " ) dtFinal "
            + " inner join encounter e on e.patient_id=dtFinal.patient_id "
            + " inner join obs obsPedido on obsPedido.encounter_id=e.encounter_id "
            + " where 	obsPedido.concept_id=23722 and obsPedido.value_coded=856 "
            + " and obsPedido.obs_datetime>=dtFinal.dataDT and obsPedido.obs_datetime<=:endRevisionDate and "
            + " obsPedido.voided=0 and obsPedido.location_id=:location and e.location_id=:location and e.voided=0 and e.encounter_type=6 ";

    public static final String findPatientsWithDTandGaacWithRequestForVLCategory15H2 =
        " select pedido.patient_id "
            + " from "
            + " ( "
            + " select dtFinal.patient_id,max(obsPedido.obs_datetime) dataPedido "
            + " from "
            + " ( "
            + " select patient_id,max(encounter_datetime) dataDT "
            + " from ( "
            + " select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p  "
            + " join encounter e on p.patient_id=e.patient_id "
            + " join obs grupo on grupo.encounter_id=e.encounter_id  "
            + " join obs o on o.encounter_id=e.encounter_id  "
            + " join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + " where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23724,23730) and o.voided=0 "
            + " and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0 "
            + " and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH) and e.location_id=:location  "
            + " group by p.patient_id "
            + " union "
            + " select max_tl.patient_id, max_tl.max_datatl encounter_datetime "
            + " from ( "
            + " select 	p.patient_id,max(o.obs_datetime) max_datatl "
            + " from 	patient p "
            + " join encounter e on p.patient_id=e.patient_id "
            + " join obs o on o.encounter_id=e.encounter_id "
            + " where 	e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 "
            + " and o.concept_id=23739 and e.location_id=:location "
            + " and o.obs_datetime between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH) "
            + " group by p.patient_id  "
            + " ) max_tl "
            + " join encounter e on e.patient_id=max_tl.patient_id "
            + " join obs on obs.encounter_id=e.encounter_id "
            + " where 	obs.concept_id=23739 and obs.value_coded=23720 and max_tl.max_datatl=obs.obs_datetime "
            + " and obs.voided=0 and obs.location_id=:location and e.location_id=:location "
            + " and e.voided=0 and e.encounter_type=6 "
            + " ) dt "
            + " group by dt.patient_id  "
            + " ) dtFinal "
            + " inner join encounter e on e.patient_id=dtFinal.patient_id "
            + " inner join obs obsPedido on obsPedido.encounter_id=e.encounter_id "
            + " where 	obsPedido.concept_id=23722 and obsPedido.value_coded=856 "
            + " and obsPedido.obs_datetime>=dtFinal.dataDT and obsPedido.obs_datetime<=:endRevisionDate and "
            + " obsPedido.voided=0 and obsPedido.location_id=:location and e.location_id=:location and e.voided=0 and e.encounter_type=6 "
            + " group by dtFinal.patient_id "
            + " ) pedido "
            + " inner join encounter e on pedido.patient_id=e.patient_id "
            + " inner join obs obsResultado on obsResultado.encounter_id=e.encounter_id "
            + " where 	e.voided=0 and e.encounter_type=13 and e.location_id=:location and obsResultado.voided=0 and "
            + " obsResultado.concept_id in (856,1305) and obsResultado.obs_datetime>=pedido.dataPedido and obsResultado.obs_datetime<=:endRevisionDate ";

    public static final String findPatientsWithMDSWhoHaveTwoVLRequestAndOneVLResult =
        "select result.patient_id from  ( "
            + "select p.patient_id,max(e.encounter_datetime) as data_mdc from patient p    "
            + "join encounter e on p.patient_id=e.patient_id   "
            + "join obs grupo on grupo.encounter_id=e.encounter_id    "
            + "join obs o on o.encounter_id=e.encounter_id    "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id   "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23724,23730,165179,165315,23888,23729) and o.voided=0   "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0   "
            + "and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  and e.location_id=:location    "
            + "group by p.patient_id   "
            + "union "
            + "select max_tipo_despensa.patient_id,max_tipo_despensa.data_mdc from   "
            + "(   "
            + "select max_tl.patient_id,max_tl.data_mdc from   (   "
            + "select p.patient_id,max(o.obs_datetime) as data_mdc from patient p   "
            + "join encounter e on p.patient_id=e.patient_id     "
            + "join obs o on o.encounter_id=e.encounter_id    "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location   "
            + "and DATE(o.obs_datetime) between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)   "
            + "group by p.patient_id  "
            + ") max_tl    "
            + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime   "
            + "where obs.concept_id=23739 and obs.value_coded in(23720,23888) and obs.voided=0 and obs.location_id=:location   "
            + ") max_tipo_despensa    "
            + "union  "
            + "select f.patient_id,f.data_levantamento as data_mdc from   (  "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  (  "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  "
            + "group by p.patient_id "
            + ")fila  "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento  "
            + "and obs_fila.concept_id=5096  "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97)  "
            + "group by fila.patient_id  "
            + ") f "
            + "union  "
            + "select f.patient_id,f.data_levantamento as data_mdc from   (  "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  (  "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  "
            + "group by p.patient_id "
            + ")fila  "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento  "
            + "and obs_fila.concept_id=5096  "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 173 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 187)  "
            + "group by fila.patient_id  "
            + ") f  "
            + ")result "
            + "inner join ( "
            + "select pedido.patient_id,pedido.data_primeira,pedido.data_segundo_pedido from  ( "
            + "select distinct cvpedido.patient_id,cvpedido.data_primeira,min(e.encounter_datetime) data_segundo_pedido from   (  "
            + "select  p.patient_id,min(e.encounter_datetime) data_primeira, e.encounter_id from patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id  "
            + "where o.concept_id=23722 and o.value_coded=856   "
            + "and p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=6 and e.encounter_datetime<=:endRevisionDate  "
            + "group by p.patient_id  "
            + ")cvpedido  "
            + "inner join encounter e on e.patient_id=cvpedido.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id  "
            + "and e.encounter_datetime>cvpedido.data_primeira and e.encounter_type=6 and o.concept_id=23722 and e.voided=0 and o.voided=0 "
            + "group by cvpedido.patient_id "
            + ") pedido   "
            + "inner join ( "
            + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
            + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
            + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
            + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
            + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
            + "AND ob.concept_id in (856) AND enc.encounter_type=6 and ob.value_numeric <=1000 "
            + "union "
            + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
            + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
            + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
            + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
            + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
            + "AND ob.concept_id in (1305) AND enc.encounter_type=6  "
            + ") cv on pedido.patient_id=cv.patient_id and cv.encounter_datetime > pedido.data_primeira and cv.encounter_datetime<pedido.data_segundo_pedido "
            + ")pedido on pedido.patient_id=result.patient_id  "
            + "where (pedido.data_primeira between result.data_mdc and :endRevisionDate) and (pedido.data_segundo_pedido between result.data_mdc and :endRevisionDate) ";

    public static final String findPatientsWithRequestOnLabFormCategory15 =
        " select f.patient_id from ( "
            + "select result.patient_id,result.data_mdc,pedido.data_primeira,pedido.data_segundo_pedido from  (    "
            + "select p.patient_id,max(e.encounter_datetime) as data_mdc from patient p    "
            + "join encounter e on p.patient_id=e.patient_id    "
            + "join obs grupo on grupo.encounter_id=e.encounter_id     "
            + "join obs o on o.encounter_id=e.encounter_id     "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id    "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23724,23730,165179,165315,23888,23729) and o.voided=0    "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0    "
            + "and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  and e.location_id=:location    "
            + "group by p.patient_id    "
            + "union  "
            + "select max_tipo_despensa.patient_id,max_tipo_despensa.data_mdc from  (    "
            + "select max_tl.patient_id,max_tl.data_mdc from   (    "
            + "select p.patient_id,max(o.obs_datetime) as data_mdc from patient p    "
            + "join encounter e on p.patient_id=e.patient_id      "
            + "join obs o on o.encounter_id=e.encounter_id     "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location   "
            + "and DATE(o.obs_datetime) between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)    "
            + "group by p.patient_id   "
            + ") max_tl     "
            + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime    "
            + "where obs.concept_id=23739 and obs.value_coded in(23720,23888) and obs.voided=0 and obs.location_id=:location   "
            + ") max_tipo_despensa     "
            + "union   "
            + "select f.patient_id,f.data_levantamento as data_mdc from   (   "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  (  "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  "
            + "group by p.patient_id "
            + ")fila  "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento  "
            + "and obs_fila.concept_id=5096  "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97)  "
            + "group by fila.patient_id  "
            + ") f  "
            + "union   "
            + "select f.patient_id,f.data_levantamento as data_mdc from   (   "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  (  "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  "
            + "group by p.patient_id "
            + ")fila  "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento  "
            + "and obs_fila.concept_id=5096  "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 173 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 187)   "
            + "group by fila.patient_id   "
            + ") f   "
            + ")result  "
            + "inner join (  "
            + "select pedido.patient_id,pedido.data_primeira,pedido.data_segundo_pedido from  (  "
            + "select distinct cvpedido.patient_id,cvpedido.data_primeira,min(e.encounter_datetime) data_segundo_pedido from   (   "
            + "select  p.patient_id,min(e.encounter_datetime) data_primeira, e.encounter_id from patient p  "
            + "inner join encounter e on e.patient_id=p.patient_id   "
            + "inner join obs o on o.encounter_id=e.encounter_id   "
            + "where o.concept_id=23722 and o.value_coded=856    "
            + "and p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=6 and e.encounter_datetime<=:endRevisionDate  "
            + "group by p.patient_id   "
            + ")cvpedido   "
            + "inner join encounter e on e.patient_id=cvpedido.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id   "
            + "and e.encounter_datetime>cvpedido.data_primeira and e.encounter_type=6 and o.concept_id=23722 and e.voided=0 and o.voided=0  "
            + " group by cvpedido.patient_id  "
            + ") pedido    "
            + "inner join "
            + "(  "
            + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
            + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
            + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
            + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
            + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
            + "AND ob.concept_id in (856) AND enc.encounter_type=6 and ob.value_numeric <=1000 "
            + "union "
            + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
            + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
            + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
            + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
            + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
            + "AND ob.concept_id in (1305) AND enc.encounter_type=6  "
            + ") cv on pedido.patient_id=cv.patient_id and cv.encounter_datetime > pedido.data_primeira and cv.encounter_datetime<pedido.data_segundo_pedido  "
            + ")pedido on pedido.patient_id=result.patient_id   "
            + "where (pedido.data_primeira between result.data_mdc and :endRevisionDate) and (pedido.data_segundo_pedido between result.data_mdc and :endRevisionDate)  "
            + ")f "
            + "inner join "
            + "( "
            + "select p.patient_id,e.encounter_datetime from patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=13 and o.concept_id in(856,1305) and p.voided=0 and e.voided=0 and o.voided=0 and e.location_id=:location "
            + ") cvLab on f.patient_id=cvLab.patient_id "
            + " where cvLab.encounter_datetime between f.data_segundo_pedido and :endRevisionDate ";

    public static final String findPatientsWithRequestOnLabFormCategory15OverThan1000 =
        " select f.patient_id from ( "
            + "select result.patient_id,result.data_mdc,pedido.data_primeira,pedido.data_segundo_pedido from  (    "
            + "select p.patient_id,max(e.encounter_datetime) as data_mdc from patient p    "
            + "join encounter e on p.patient_id=e.patient_id    "
            + "join obs grupo on grupo.encounter_id=e.encounter_id     "
            + "join obs o on o.encounter_id=e.encounter_id     "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id    "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23724,23730,165179,165315,23888,23729) and o.voided=0    "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0    "
            + "and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  and e.location_id=:location    "
            + "group by p.patient_id    "
            + "union  "
            + "select max_tipo_despensa.patient_id,max_tipo_despensa.data_mdc from  (    "
            + "select max_tl.patient_id,max_tl.data_mdc from   (    "
            + "select p.patient_id,max(o.obs_datetime) as data_mdc from patient p    "
            + "join encounter e on p.patient_id=e.patient_id      "
            + "join obs o on o.encounter_id=e.encounter_id     "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location   "
            + "and DATE(o.obs_datetime) between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)    "
            + "group by p.patient_id   "
            + ") max_tl     "
            + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime    "
            + "where obs.concept_id=23739 and obs.value_coded in(23720,23888) and obs.voided=0 and obs.location_id=:location   "
            + ") max_tipo_despensa     "
            + "union   "
            + "select f.patient_id,f.data_levantamento as data_mdc from   (   "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  (  "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  "
            + "group by p.patient_id "
            + ")fila  "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento  "
            + "and obs_fila.concept_id=5096  "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97)  "
            + "group by fila.patient_id  "
            + ") f  "
            + "union   "
            + "select f.patient_id,f.data_levantamento as data_mdc from   (   "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  (  "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id  "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime  between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and (:endRevisionDate - INTERVAL 24 MONTH)  "
            + "group by p.patient_id "
            + ")fila  "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento  "
            + "and obs_fila.concept_id=5096  "
            + "and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 173 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 187)   "
            + "group by fila.patient_id   "
            + ") f   "
            + ")result  "
            + "inner join (  "
            + "select pedido.patient_id,pedido.data_primeira,pedido.data_segundo_pedido from  (  "
            + "select distinct cvpedido.patient_id,cvpedido.data_primeira,min(e.encounter_datetime) data_segundo_pedido from   (   "
            + "select  p.patient_id,min(e.encounter_datetime) data_primeira, e.encounter_id from patient p  "
            + "inner join encounter e on e.patient_id=p.patient_id   "
            + "inner join obs o on o.encounter_id=e.encounter_id   "
            + "where o.concept_id=23722 and o.value_coded=856    "
            + "and p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=6 and e.encounter_datetime<=:endRevisionDate  "
            + "group by p.patient_id   "
            + ")cvpedido   "
            + "inner join encounter e on e.patient_id=cvpedido.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id   "
            + "and e.encounter_datetime>cvpedido.data_primeira and e.encounter_type=6 and o.concept_id=23722 and e.voided=0 and o.voided=0  "
            + " group by cvpedido.patient_id  "
            + ") pedido    "
            + "inner join (  "
            + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
            + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
            + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
            + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
            + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
            + "AND ob.concept_id in (856) AND enc.encounter_type=6 and ob.value_numeric <=1000 "
            + "union "
            + "SELECT pat.patient_id,enc.encounter_datetime encounter_datetime  "
            + "FROM   patient pat JOIN encounter enc ON pat.patient_id=enc.patient_id  "
            + "JOIN   obs ob ON enc.encounter_id=ob.encounter_id  "
            + "WHERE  pat.voided=0 AND enc.voided=0 AND ob.voided=0 AND enc.location_id=:location  "
            + "AND enc.encounter_datetime<=:endRevisionDate  AND enc.encounter_type=6 "
            + "AND ob.concept_id in (1305) AND enc.encounter_type=6  "
            + ") cv on pedido.patient_id=cv.patient_id and cv.encounter_datetime > pedido.data_primeira and cv.encounter_datetime<pedido.data_segundo_pedido  "
            + ")pedido on pedido.patient_id=result.patient_id   "
            + "where (pedido.data_primeira between result.data_mdc and :endRevisionDate) and (pedido.data_segundo_pedido between result.data_mdc and :endRevisionDate)  "
            + ")f "
            + "inner join "
            + "( "
            + "select p.patient_id,e.encounter_datetime from patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=13 and o.concept_id=856 and p.voided=0 and e.voided=0 and o.voided=0 and e.location_id=:location and o.value_numeric < 1000 "
            + "union "
            + "select p.patient_id,e.encounter_datetime from patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=13 and o.concept_id=1305 and p.voided=0 and e.voided=0 and o.voided=0 and e.location_id=:location "
            + ") cvLab on f.patient_id=cvLab.patient_id "
            + " where (cvLab.encounter_datetime between f.data_segundo_pedido and :endRevisionDate) ";

    public static final String findPatientsWithDTWithRequestForVLAndVLResultCategory15 =
        " select pedido.patient_id "
            + " from "
            + " ( "
            + " select dtFinal.patient_id,max(obsPedido.obs_datetime) dataPedido "
            + " from "
            + " ( "
            + " select patient_id,max(encounter_datetime) dataDT "
            + " from ( "
            + " select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p  "
            + " join encounter e on p.patient_id=e.patient_id "
            + " join obs grupo on grupo.encounter_id=e.encounter_id  "
            + " join obs o on o.encounter_id=e.encounter_id  "
            + " join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + " where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23730) and o.voided=0 "
            + " and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0 "
            + " and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH) and e.location_id=:location  "
            + " group by p.patient_id "
            + " union "
            + " select max_tl.patient_id, max_tl.max_datatl encounter_datetime "
            + " from ( "
            + " select 	p.patient_id,max(o.obs_datetime) max_datatl "
            + " from 	patient p "
            + " join encounter e on p.patient_id=e.patient_id "
            + " join obs o on o.encounter_id=e.encounter_id "
            + " where 	e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 "
            + " and o.concept_id=23739 and e.location_id=:location "
            + " and o.obs_datetime between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH) "
            + " group by p.patient_id  "
            + " ) max_tl "
            + " join encounter e on e.patient_id=max_tl.patient_id "
            + " join obs on obs.encounter_id=e.encounter_id "
            + " where 	obs.concept_id=23739 and obs.value_coded=23720 and max_tl.max_datatl=obs.obs_datetime "
            + " and obs.voided=0 and obs.location_id=:location and e.location_id=:location "
            + " and e.voided=0 and e.encounter_type=6 "
            + " ) dt "
            + " group by dt.patient_id  "
            + " ) dtFinal "
            + " inner join encounter e on e.patient_id=dtFinal.patient_id "
            + " inner join obs obsPedido on obsPedido.encounter_id=e.encounter_id "
            + " where 	obsPedido.concept_id=23722 and obsPedido.value_coded=856 "
            + " and obsPedido.obs_datetime>=dtFinal.dataDT and obsPedido.obs_datetime<=:endRevisionDate and "
            + " obsPedido.voided=0 and obsPedido.location_id=:location and e.location_id=:location and e.voided=0 and e.encounter_type=6 "
            + " group by dtFinal.patient_id "
            + " ) pedido "
            + " inner join encounter e on pedido.patient_id=e.patient_id "
            + " inner join obs obsResultado on obsResultado.encounter_id=e.encounter_id "
            + " where 	e.voided=0 and e.encounter_type=13 and e.location_id=:location and obsResultado.voided=0 and "
            + " obsResultado.concept_id in (856,1305) and obsResultado.obs_datetime>=pedido.dataPedido and obsResultado.obs_datetime<=:endRevisionDate ";

    public static final String findPatientsWithDTandGaacWithCV1000Category15I =
        " select pedido.patient_id	"
            + " from "
            + " ( "
            + " select dtFinal.patient_id,max(obsPedido.obs_datetime) dataPedido	"
            + " from	"
            + " (	"
            + " select patient_id,max(encounter_datetime) dataDT "
            + " from (	"
            + " select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p   "
            + " join encounter e on p.patient_id=e.patient_id  "
            + " join obs grupo"
            + " on grupo.encounter_id=e.encounter_id   "
            + " join obs o on o.encounter_id=e.encounter_id   "
            + " join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + " where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23724,23730) and o.voided=0  "
            + " and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0  "
            + " and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH) and e.location_id=:location   group by p.patient_id "
            + " union	"
            + " select max_tl.patient_id, max_tl.max_datatl encounter_datetime	"
            + " from (	"
            + " select 	p.patient_id,max(o.obs_datetime) max_datatl	"
            + " from 	patient p	"
            + " join encounter e on p.patient_id=e.patient_id	"
            + " join obs o on o.encounter_id=e.encounter_id	"
            + " where 	e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0	"
            + " and o.concept_id=23739 and e.location_id=:location	"
            + " and o.obs_datetime between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH)	"
            + " group by p.patient_id "
            + "   ) max_tl	"
            + " join encounter e on e.patient_id=max_tl.patient_id	"
            + " join obs on obs.encounter_id=e.encounter_id	"
            + " where 	obs.concept_id=23739 and obs.value_coded=23720 and max_tl.max_datatl=obs.obs_datetime	"
            + " and obs.voided=0 and obs.location_id=:location and e.location_id=:location	"
            + " and e.voided=0 and e.encounter_type=6	"
            + " ) dt	"
            + " group by dt.patient_id 	"
            + " ) dtFinal	"
            + " inner join encounter e on e.patient_id=dtFinal.patient_id	"
            + " inner join obs obsPedido on obsPedido.encounter_id=e.encounter_id	"
            + " where 	obsPedido.concept_id=23722 and obsPedido.value_coded=856	"
            + " and obsPedido.obs_datetime>=dtFinal.dataDT and obsPedido.obs_datetime<=:endRevisionDate and	"
            + " obsPedido.voided=0 and obsPedido.location_id=:location and e.location_id=:location and e.voided=0 and e.encounter_type=6	"
            + " group by dtFinal.patient_id	"
            + " ) pedido "
            + " inner join encounter e on pedido.patient_id=e.patient_id "
            + " inner join obs obsResultado on obsResultado.encounter_id=e.encounter_id	"
            + " where 	e.voided=0 and e.encounter_type=13 and e.location_id=:location and obsResultado.voided=0 and "
            + " (obsResultado.concept_id=1305 or (obsResultado.concept_id=856 and obsResultado.value_numeric<1000)) and obsResultado.obs_datetime>=pedido.dataPedido and obsResultado.obs_datetime<=:endRevisionDate	";

    public static final String findPatientsWithDTWithCV1000Category15I =
        " select pedido.patient_id	"
            + " from "
            + " ( "
            + " select dtFinal.patient_id,max(obsPedido.obs_datetime) dataPedido	"
            + " from	"
            + " (	"
            + " select patient_id,max(encounter_datetime) dataDT "
            + " from (	"
            + " select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p   "
            + " join encounter e on p.patient_id=e.patient_id  "
            + " join obs grupo"
            + " on grupo.encounter_id=e.encounter_id   "
            + " join obs o on o.encounter_id=e.encounter_id   "
            + " join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + " where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23730) and o.voided=0  "
            + " and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded =1256  and obsEstado.voided=0  and grupo.voided=0  "
            + " and DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH) and e.location_id=:location   group by p.patient_id "
            + " union	"
            + " select max_tl.patient_id, max_tl.max_datatl encounter_datetime	"
            + " from (	"
            + " select 	p.patient_id,max(o.obs_datetime) max_datatl	"
            + " from 	patient p	"
            + " join encounter e on p.patient_id=e.patient_id	"
            + " join obs o on o.encounter_id=e.encounter_id	"
            + " where 	e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0	"
            + " and o.concept_id=23739 and e.location_id=:location	"
            + " and o.obs_datetime between (:endRevisionDate - INTERVAL 14 MONTH) and (:endRevisionDate - INTERVAL 11 MONTH)	"
            + " group by p.patient_id "
            + "   ) max_tl	"
            + " join encounter e on e.patient_id=max_tl.patient_id	"
            + " join obs on obs.encounter_id=e.encounter_id	"
            + " where 	obs.concept_id=23739 and obs.value_coded=23720 and max_tl.max_datatl=obs.obs_datetime	"
            + " and obs.voided=0 and obs.location_id=:location and e.location_id=:location	"
            + " and e.voided=0 and e.encounter_type=6	"
            + " ) dt	"
            + " group by dt.patient_id 	"
            + " ) dtFinal	"
            + " inner join encounter e on e.patient_id=dtFinal.patient_id	"
            + " inner join obs obsPedido on obsPedido.encounter_id=e.encounter_id	"
            + " where 	obsPedido.concept_id=23722 and obsPedido.value_coded=856	"
            + " and obsPedido.obs_datetime>=dtFinal.dataDT and obsPedido.obs_datetime<=:endRevisionDate and	"
            + " obsPedido.voided=0 and obsPedido.location_id=:location and e.location_id=:location and e.voided=0 and e.encounter_type=6	"
            + " group by dtFinal.patient_id	"
            + " ) pedido "
            + " inner join encounter e on pedido.patient_id=e.patient_id "
            + " inner join obs obsResultado on obsResultado.encounter_id=e.encounter_id	"
            + " where 	e.voided=0 and e.encounter_type=13 and e.location_id=:location and obsResultado.voided=0 and "
            + " (obsResultado.concept_id=1305 or (obsResultado.concept_id=856 and obsResultado.value_numeric<1000)) and obsResultado.obs_datetime>=pedido.dataPedido and obsResultado.obs_datetime<=:endRevisionDate	";

    public static final String findPatientsWhoArePregnantSpecificForCategory15 =
        " SELECT p.patient_id FROM person pe "
            + " INNER JOIN patient p ON pe.person_id = p.patient_id "
            + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
            + " INNER JOIN obs obsGravida ON e.encounter_id = obsGravida.encounter_id "
            + " WHERE pe.voided = 0 AND p.voided = 0 AND e.voided = 0 AND obsGravida.voided = 0 AND e.encounter_type = 6 AND e.location_id = :location "
            + " AND e.encounter_datetime >= DATE_SUB(:endRevisionDate, INTERVAL 14 MONTH) AND e.encounter_datetime <= :endRevisionDate "
            + " AND obsGravida.concept_id = 1982 AND obsGravida.value_coded = 1065 AND pe.gender = 'F' ";

    public static final String findPatientsWhoAreBreastfeedingSpecificForCategory15 =
        " SELECT p.patient_id FROM person pe "
            + " INNER JOIN patient p ON pe.person_id = p.patient_id "
            + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
            + " INNER JOIN obs obsLactante ON e.encounter_id = obsLactante.encounter_id "
            + " WHERE pe.voided = 0 AND p.voided = 0 AND e.voided = 0 AND obsLactante.voided = 0 AND e.encounter_type = 6 AND e.location_id = :location "
            + " AND e.encounter_datetime >= DATE_SUB(:endRevisionDate, INTERVAL 14 MONTH) AND e.encounter_datetime <= :endRevisionDate "
            + " AND obsLactante.concept_id = 6332 AND obsLactante.value_coded = 1065 AND pe.gender = 'F' ";

    public static final String findPatientsWhoHaveCVOverThan10000Category15 =
        " select cv.patient_id from ( "
            + " Select p.patient_id, min(e.encounter_datetime) data_carga from patient p "
            + " inner join encounter e on p.patient_id = e.patient_id "
            + " inner join obs o on e.encounter_id=o.encounter_id "
            + " where p.voided = 0 and e.voided = 0 and o.voided = 0 and e.encounter_type = 6 and  o.concept_id = 856 and "
            + " DATE(e.encounter_datetime) between (:endRevisionDate - INTERVAL 26 MONTH + INTERVAL  1 DAY) and :endRevisionDate and e.location_id = :location and o.value_numeric >= 1000 "
            + " group by p.patient_id "
            + ")cv";

    public static final String findPatientsWhoHasRegisteredAsIniciarInAtLeastOneMDS =
        "select patient_id from (  "
            + "select maxEnc.patient_id,o.obs_datetime as data_Observacao,maxEnc.data as maxima_consulta,dataMaximoModelo.data as maximo_modelo from  "
            + "(  "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p  "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id  "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6  "
            + "and e.encounter_datetime between :startInclusionDate and  :endInclusionDate and e.location_id=:location  "
            + "group by patient_id  "
            + ")maxEnc  "
            + "inner join  "
            + "( "
            + "select p.patient_id, e.encounter_datetime data FROM patient p  "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id   "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type=6 and o.concept_id=165174 and o.value_coded in(23724,23730,23888,23729,23731,165315,165179) and grupo.concept_id=165323 "
            + "and obsEstado.concept_id=165322  and obsEstado.value_coded =1256 and  e.location_id=:location "
            + "and p.voided=0 and e.voided=0 and o.voided=0 and grupo.voided=0 and obsEstado.voided=0 and e.encounter_datetime<:endRevisionDate "
            + ")dataMaximoModelo on dataMaximoModelo.patient_id=maxEnc.patient_id  "
            + "inner join obs o on o.person_id=maxEnc.patient_id "
            + "and o.concept_id = 165174 "
            + "and o.value_coded in(23724,23730,23888,23729,23731,165315,165179) "
            + "and dataMaximoModelo.data=maxEnc.data  "
            + "and dataMaximoModelo.data=o.obs_datetime "
            + "and o.location_id=:location "
            + "group by maxEnc.patient_id "
            + ") final ";

    // L
    public static final String findPatientsWhoHasRegisteredAsFimInAtLeastOneMDS =
        "select patient_id from  (  "
            + "select maxEnc.patient_id, o.obs_datetime as data_Observacao, maxEnc.data as maxima_consulta, dataMaximoModelo.data as maximo_modelo from  "
            + "(  "
            + "select p.patient_id, max(e.encounter_datetime) data FROM patient p  "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id  "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6  "
            + "and e.encounter_datetime between :startInclusionDate and  :endInclusionDate and e.location_id =:location  "
            + "group by patient_id  "
            + ")maxEnc  "
            + "inner join  (  "
            + "select p.patient_id, e.encounter_datetime data FROM patient p  "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id   "
            + "join obs o on o.encounter_id=e.encounter_id   "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type=6 and o.concept_id=165174 and o.value_coded in(23724,23730,23888,23729,23731,165315,165179) and grupo.concept_id=165323  "
            + "and obsEstado.concept_id=165322  and obsEstado.value_coded =1267 and  e.location_id =:location "
            + "and p.voided=0 and e.voided=0 and o.voided=0 and grupo.voided=0 and obsEstado.voided=0 and e.encounter_datetime<:endRevisionDate  "
            + ")dataMaximoModelo on dataMaximoModelo.patient_id=maxEnc.patient_id  "
            + "inner join obs o on o.person_id=maxEnc.patient_id   "
            + "and o.concept_id = 165174 "
            + "and o.value_coded in(23724,23730,23888,23729,23731,165315,165179)   "
            + "and dataMaximoModelo.data=maxEnc.data  "
            + "and dataMaximoModelo.data=o.obs_datetime  "
            + "and o.location_id=:location "
            + "group by maxEnc.patient_id  "
            + ") final ";

    public static final String
        findPatientsRegisteredInOneMDSForStablePatientsAndHadCVBetween18And24nMonthsAfterCVLessThan1000 =
            "			select e.patient_id  from "
                + "			( "
                + "			 select ultimaCVAlta.patient_id, MAX(ultimaCVAlta.data_carga) as data_carga  from "
                + "			 (Select p.patient_id, max(e.encounter_datetime) encounter_datetime "
                + "			 from patient p "
                + "                inner join encounter e on p.patient_id = e.patient_id "
                + "                where p.voided = 0 and e.voided = 0 and e.encounter_type = 6 and "
                + "                e.encounter_datetime >= :startInclusionDate and e.encounter_datetime <= :endInclusionDate and e.location_id = :location "
                + "                group by p.patient_id "
                + "                )maxEnc "
                + "                  inner join "
                + "                 ( Select p.patient_id, e.encounter_datetime as data_carga "
                + "                 from patient p "
                + "                 inner join encounter e on p.patient_id = e.patient_id "
                + "                 inner join obs o on e.encounter_id = o.encounter_id "
                + "                 where p.voided = 0 and e.voided = 0 and o.voided = 0 and e.encounter_type = 6 and ((o.concept_id = 856 and o.value_numeric < 1000) OR (o.concept_id = 1305 and o.value_coded is not null)) and e.location_id = :location "
                + "                 ) ultimaCVAlta on ultimaCVAlta.patient_id = maxEnc.patient_id and ultimaCVAlta.data_carga < (maxEnc.encounter_datetime - INTERVAL 24 MONTH) "
                + "				group by ultimaCVAlta.patient_id "
                + "                 )final "
                + "                 inner join encounter e on e.patient_id = final.patient_id "
                + "                 inner join obs o on e.encounter_id = o.encounter_id "
                + "                 where e.voided = 0 and o.voided = 0 and e.encounter_type = 6 and ((o.concept_id = 856 and o.value_numeric is not null) OR (o.concept_id = 1305 and o.value_coded is not null)) "
                + "                 and e.location_id = :location and e.encounter_datetime between (final.data_carga + INTERVAL 10 MONTH) and (final.data_carga + INTERVAL 20 MONTH) "
                + "                 group by e.patient_id ";

    public static String findPatientWhoArePregnantOrBreastfeeding14Months(WomanState womanState) {
      String query =
          " select f.patient_id from ( "
              + "select p.person_id as  patient_id,	 "
              + "lactante.data_lactante, "
              + "gravida.data_gravida, "
              + "if(lactante.data_lactante is null,1, "
              + "if(gravida.data_gravida is null,2, "
              + "if(gravida.data_gravida>=lactante.data_lactante,1,2))) decisao from person p "
              + "left join ( "
              + "SELECT p.patient_id, e.encounter_datetime data_lactante FROM patient p  "
              + "INNER JOIN encounter e ON p.patient_id = e.patient_id  "
              + "INNER JOIN obs obsLactante ON e.encounter_id = obsLactante.encounter_id  "
              + "WHERE p.voided = 0 AND e.voided = 0 AND obsLactante.voided = 0 AND e.encounter_type = 6 AND e.location_id = :location  "
              + "AND e.encounter_datetime between (:endRevisionDate - INTERVAL 14 MONTH + INTERVAL 1 DAY) and :endRevisionDate  "
              + "AND obsLactante.concept_id = 6332 AND obsLactante.value_coded = 1065 "
              + "group by patient_id  "
              + ") lactante on p.person_id=lactante.patient_id "
              + "left join "
              + "( "
              + "SELECT p.patient_id, e.encounter_datetime data_gravida FROM patient p  "
              + "INNER JOIN encounter e ON p.patient_id = e.patient_id  "
              + "INNER JOIN obs obsGravida ON e.encounter_id = obsGravida.encounter_id  "
              + "WHERE p.voided = 0 AND e.voided = 0 AND obsGravida.voided = 0 AND e.encounter_type = 6 AND e.location_id = :location  "
              + "AND e.encounter_datetime between (:endRevisionDate - INTERVAL 14 MONTH + INTERVAL 1 DAY) and :endRevisionDate  "
              + "AND obsGravida.concept_id = 1982 AND obsGravida.value_coded = 1065  "
              + "group by patient_id  "
              + ")gravida on gravida.patient_id=p.person_id "
              + "where 	(lactante.data_lactante is not null or gravida.data_gravida is not null) and p.voided=0 and p.gender='F' "
              + "group by p.person_id "
              + ")f where decisao=%s ";

      switch (womanState) {
        case PREGNANT:
          query = String.format(query, 1);
          break;

        case BREASTFEEDING:
          query = String.format(query, 2);
          break;
      }
      return query;
    }

    public static final String
        findAllPatientsWhoHaveLaboratoryInvestigationsRequestsAndViralChargeInLastConsultationDuringLastThreeMonths =
            "Select patient_id from ( "
                + "Select maxEnc.patient_id,maxEnc.encounter_datetime, obsCV.obs_datetime from ( "
                + "Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
                + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate and e.location_id=:location "
                + "group by p.patient_id "
                + ") maxEnc "
                + "inner join encounter  e on e.patient_id=maxEnc.patient_id "
                + "inner join obs obsCV on obsCV.encounter_id=e.encounter_id "
                + "where obsCV.concept_id=23722 and obsCV.value_coded = 856 and obsCV.voided=0 and e.voided=0 "
                + " and e.encounter_type  = 6 and e.location_id = :location "
                + "and e.encounter_datetime >= (maxEnc.encounter_datetime - INTERVAL 3 MONTH) AND  e.encounter_datetime < maxEnc.encounter_datetime "
                + "group by maxEnc.patient_id "
                + ") final "
                + "group by final.patient_id ";

    public static final String
        findPatientsWithClinicalConsultationAndARTStartDateGreaterThanThreeMonths =
            " SELECT patient_id from ( "
                + " select art.patient_id, art.art_start_date from (SELECT patient_id, art_start_date FROM ( "
                + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
                + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
                + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
                + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
                + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
                + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endRevisionDate AND e.location_id =:location "
                + " GROUP BY p.patient_id "
                + " ) art_start "
                + " GROUP BY art_start.patient_id "
                + " ) tx_new "
                + ") art "
                + "inner join "
                + "(select patient_id, encounter_datetime from ( "
                + "select p.patient_id, max(e.encounter_datetime) encounter_datetime FROM patient p "
                + "INNER JOIN encounter e on p.patient_id=e.patient_id "
                + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
                + "and e.encounter_datetime between (:endRevisionDate - INTERVAL 12 MONTH + INTERVAL  1 DAY) and :endRevisionDate "
                + "and e.location_id=:location "
                + "group by p.patient_id "
                + ") maxEnc "
                + ") consulta on consulta.patient_id = art.patient_id "
                + "where (TIMESTAMPDIFF(MONTH,art.art_start_date,consulta.encounter_datetime)) >3 "
                + ") final ";

    public static final String findPatientsWhoAreInTbTreatmentFor7MonthsPriorEndRevisionPeriod =
        "select tb.patient_id from ( select inicioTB.patient_id from ( "
            + "select p.patient_id,min(o.value_datetime) data_inicio_tb from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type in (6,9) and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=1113 and e.location_id=:location "
            + "and  o.value_datetime  between (:endRevisionDate - INTERVAL 7 MONTH ) and :endRevisionDate "
            + "group by p.patient_id "
            + ") inicioTB "
            + "left join ( "
            + "select p.patient_id,max(o.value_datetime) data_fim_tb  from 	patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type in (6,9) and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=6120 and e.location_id=:location "
            + "and o.value_datetime between (:endRevisionDate - INTERVAL 7 MONTH ) and :endRevisionDate "
            + "group by p.patient_id "
            + ") fim_tb "
            + "on inicioTB.patient_id=fim_tb.patient_id and inicioTB.data_inicio_tb<fim_tb.data_fim_tb "
            + "where fim_tb.patient_id is null "
            + "union "
            + "select p.patient_id from patient p "
            + "inner join patient_program pg on p.patient_id=pg.patient_id "
            + "where pg.program_id=5 and pg.voided=0 and p.voided=0 and pg.date_enrolled between (:endRevisionDate - INTERVAL 7 MONTH) and :endRevisionDate "
            + "and pg.location_id=:location and (pg.date_completed is null or (pg.date_completed is not null and pg.date_completed> :endRevisionDate)) "
            + "union "
            + "select p.patient_id from patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "inner join obs obsTB on obsTB.encounter_id=e.encounter_id "
            + "where p.voided=0 and e.voided=0 and obsTB.obs_datetime between :endRevisionDate - INTERVAL 7 MONTH and  :endRevisionDate  and "
            + "e.location_id=:location and e.encounter_type=53 and obsTB.concept_id=1406 and obsTB.value_coded =42 and obsTB.voided=0 "
            + "group by p.patient_id "
            + "union "
            + "select max_tb.patient_id from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datatb from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type in (6,9) and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=1268 and e.location_id=:location "
            + "and o.obs_datetime between (:endRevisionDate - INTERVAL 7 MONTH) and :endRevisionDate "
            + "group by p.patient_id "
            + ") max_tb "
            + "inner join obs on obs.person_id=max_tb.patient_id and max_tb.max_datatb=obs.obs_datetime "
            + "where obs.concept_id=1268 and obs.value_coded = 1256 and obs.voided=0 and obs.location_id=:location "
            + "union "
            + "select maxdiagnostico.patient_id from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datadiagnostico from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23761 "
            + "and e.encounter_datetime between (:endRevisionDate - INTERVAL 7 MONTH ) and :endRevisionDate and e.location_id=:location "
            + "group by p.patient_id "
            + ") maxdiagnostico "
            + "inner join obs o on o.person_id=maxdiagnostico.patient_id "
            + "where o.voided=0 and o.concept_id=23761 and o.obs_datetime=maxdiagnostico.max_datadiagnostico and "
            + "o.value_coded=1065 and o.location_id=:location "
            + ") tb group by tb.patient_id ";
  }
}
