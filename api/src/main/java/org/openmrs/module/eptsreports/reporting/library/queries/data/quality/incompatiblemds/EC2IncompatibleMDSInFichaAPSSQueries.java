package org.openmrs.module.eptsreports.reporting.library.queries.data.quality.incompatiblemds;

public interface EC2IncompatibleMDSInFichaAPSSQueries {
  class QUERY {

    public static String findPatiendsWithIncompatibleMDSInFichaAPSS =
        "    						select distinct patient.patient_id, "
            + "                           	l.name locationName, "
            + "                           	patient_identifier.patient_identifier_id, "
            + "                           	patient_identifier.identifier, "
            + "                            		concat(ifnull(person_name.given_name,''),' ',ifnull(person_name.middle_name,''),' ',ifnull(person_name.family_name,'')) as nomeCompleto, "
            + "                            		DATE_FORMAT(person.birthdate, '%d/%m/%Y') as birthdate, "
            + "                            		if(person.birthdate_estimated = true, 'Sim','Não') birthdate_estimated, "
            + "                            		person.gender , "
            + "                            		DATE_FORMAT(patient.date_created, '%d/%m/%Y') AS First_entry_date, "
            + "                            		DATE_FORMAT(patient.date_changed, '%d/%m/%Y') AS date_changed, "
            + "                            		patient_identifier.date_created dataCriacaoNID, "
            + "                            		if(patient_identifier.preferred = true, 'Sim','Não') nidPreferido, "
            + "                            		 DATE_FORMAT(programState.date_enrolled, '%d/%m/%Y') AS date_enrolled, "
            + "						 case "
            + "						 when programState.state = 9 then 'DROPPED FROM TREATMENT' "
            + "						 when programState.state = 35 then 'ACTIVE ON PROGRAM' "
            + "						 when programState.state = 10 then 'PATIENT HAS DIED' "
            + "						 when programState.state = 8 then 'SUSPENDED TREATMENT' "
            + "						 when programState.state = 7 then 'TRANSFERED OUT TO ANOTHER FACILITY' "
            + "						 when programState.state = 29 then 'TRANSFERRED FROM OTHER FACILTY' "
            + "						 end AS state, "
            + "						 DATE_FORMAT(programState.start_date, '%d/%m/%Y') AS state_date, "
            + "						 DATE_FORMAT(dsdFinal.data_mdc, '%d/%m/%Y') AS data_mdc, "
            + "						 DATE_FORMAT(dsdFinal.date_created, '%d/%m/%Y') AS data_registo, "
            + "						 case "
            + "						 when dsdFinal.valueDSD = 23730 then 'DT' "
            + "						 when dsdFinal.valueDSD = 165314 then 'DA' "
            + "						 when dsdFinal.valueDSD = 23888 then 'DS' "
            + "						 when dsdFinal.valueDSD = 23724 then 'GA' "
            + "						 when dsdFinal.valueDSD= 165317 then 'TB' "
            + "						 when dsdFinal.valueDSD = 165320 then 'SMI' "
            + "						 when dsdFinal.valueDSD = 165321 then 'DAH' "
            + "						 when dsdFinal.valueDSD = 165178 then 'DCP' "
            + "						 when dsdFinal.valueDSD = 165179 then 'DCA' "
            + "						 when dsdFinal.valueDSD= 165318 then 'CT' "
            + "						 when dsdFinal.valueDSD = 165315 then 'DD' "
            + "						 when dsdFinal.valueDSD = 165264 then 'BM' "
            + "						 when dsdFinal.valueDSD = 165265 then 'CM' "
            + "						 when dsdFinal.valueDSD = 165176 then 'EH' "
            + "						 when dsdFinal.valueDSD = 165319 then 'SAAJ' "
            + "						 end AS mainDSD, "
            + "						 case "
            + "						 when dsdFinal.estadoDSD = 1256 then 'I' "
            + "						 when dsdFinal.estadoDSD = 1257 then 'C' "
            + "						 end AS mainDSDEstado, "
            + "						 case "
            + "						 when dsdFinal.valueIncDSD = 23730 then 'DT' "
            + "						 when dsdFinal.valueIncDSD = 165314 then 'DA' "
            + "						 when dsdFinal.valueIncDSD = 23888 then 'DS' "
            + "						 when dsdFinal.valueIncDSD = 23724 then 'GA' "
            + "						 when dsdFinal.valueIncDSD= 165317 then 'TB' "
            + "						 when dsdFinal.valueIncDSD = 165320 then 'SMI' "
            + "						 when dsdFinal.valueIncDSD = 165321 then 'DAH' "
            + "						 when dsdFinal.valueIncDSD = 165178 then 'DCP' "
            + "						 when dsdFinal.valueIncDSD = 165179 then 'DCA' "
            + "						 when dsdFinal.valueIncDSD = 165318 then 'CT' "
            + "						 when dsdFinal.valueIncDSD = 165315 then 'DD' "
            + "						 when dsdFinal.valueIncDSD = 165264 then 'BM' "
            + "						 when dsdFinal.valueIncDSD = 165265 then 'CM' "
            + "						 when dsdFinal.valueIncDSD = 165176 then 'EH' "
            + "						 when dsdFinal.valueIncDSD = 165319 then 'SAAJ' "
            + "						 end AS incompatibleDSD, "
            + "						 case "
            + "						 when dsdFinal.dsdIncEstado = 1256 then 'I' "
            + "						 when dsdFinal.dsdIncEstado = 1257 then 'C' "
            + "						 end AS incompatibleDSDEstado "
            + "                           from "
            + "                           ( "
            + "             				   select distinct patient.patient_id, patient_identifier.identifier from( "
            + "             select identifier  from patient_identifier pi "
            + "             	join patient on patient.patient_id = pi.patient_id "
            + "             where pi.voided = 0 and  pi.identifier_type =2 "
            + "             and patient.voided =0 "
            + "             group by pi.identifier  having count(*) >= 2 "
            + "             ) NID "
            + "             inner join patient_identifier on patient_identifier.identifier = NID.identifier "
            + "             inner join patient on patient.patient_id =patient_identifier.patient_id "
            + "             where patient.voided =0 and patient_identifier.voided =0  order by patient_identifier.identifier "
            + "             		     ) patientNID "
            + "                            inner join patient_identifier on patient_identifier.identifier = patientNID.identifier and patient_identifier.preferred = true "
            + "                            inner join patient on patient.patient_id =patient_identifier.patient_id "
            + "                            inner join person  on person.person_id =patient.patient_id "
            + "                            inner join person_name on person_name.person_id = patient.patient_id "
            + "                            left join location l on (l.location_id =patient_identifier.location_id and l.retired =0) "
            + "                            left join patient_program on (patient_program.patient_id = patient.patient_id and patient_program.program_id=2 and patient_program.voided =0) "
            + "					 LEFT JOIN (SELECT pg.patient_id, pg.date_enrolled, ps.state, max(ps.start_date) AS start_date "
            + "					 FROM patient_program pg "
            + "					 INNER JOIN patient_state ps ON pg.patient_program_id = ps.patient_program_id "
            + "					 AND ps.start_date IS NOT NULL "
            + "					 AND ps.end_date IS NULL "
            + "					 AND pg.program_id = 2 "
            + "					 GROUP BY pg.patient_id "
            + "					 ) AS programState  ON patient.patient_id = programState.patient_id "
            + "					 inner join ( "
            + "					 select distinct dt.patient_id, dt.data_mdc,date_created, valueDSD, estadoDSD, dtIncompatibleMDS.valueIncDSD,dtIncompatibleMDS.dsdIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDSD, obsEstado.value_coded estadoDSD from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 23730 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dt "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDSD, obsEstado.value_coded dsdIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165314, 23888, 23724, 165317, 165320, 165321) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dtIncompatibleMDS on (dtIncompatibleMDS.patient_id = dt.patient_id and dtIncompatibleMDS.encounter_id = dt.encounter_id) "
            + "					 union "
            + "					  select distinct ds.patient_id, ds.data_mdc,date_created, valueDS, dsEstado, dsIncompatibleMDS.valueIncDS,dsIncompatibleMDS.dsIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDS, obsEstado.value_coded dsEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 23888 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) ds "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDS, obsEstado.value_coded dsIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (23724, 165178, 165179, 165317, 165318, 165320, 165321, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dsIncompatibleMDS on (dsIncompatibleMDS.patient_id = ds.patient_id and dsIncompatibleMDS.encounter_id = ds.encounter_id) "
            + "					 union "
            + "					  select distinct ga.patient_id, ga.data_mdc,date_created, valueGA, gaEstado, gaIncompatibleMDS.valueIncGA,gaIncompatibleMDS.gaIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueGA, obsEstado.value_coded gaEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 23724 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) ga "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncGA, obsEstado.value_coded gaIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165178, 165179, 165265, 165317, 165320, 165321, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) gaIncompatibleMDS on (gaIncompatibleMDS.patient_id = ga.patient_id and gaIncompatibleMDS.encounter_id = ga.encounter_id) "
            + "					 union "
            + "					 select distinct dcp.patient_id, dcp.data_mdc,date_created, valueDCP, dcpEstado, dcpIncompatibleMDS.valueIncDCP,dcpIncompatibleMDS.dcpIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDCP, obsEstado.value_coded dcpEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165178 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257) and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dcp "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDCP, obsEstado.value_coded dcpIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165179, 165264, 165265, 165320, 165315, 165314, 165318) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dcpIncompatibleMDS on (dcpIncompatibleMDS.patient_id = dcp.patient_id and dcpIncompatibleMDS.encounter_id = dcp.encounter_id) "
            + "					 union "
            + "					 select distinct dca.patient_id, dca.data_mdc,date_created, valueDCA, dcaEstado, dcaIncompatibleMDS.valueIncDCA,dcaIncompatibleMDS.dcaIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDCA, obsEstado.value_coded dcaEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165179 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dca "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDCA, obsEstado.value_coded dcaIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165264, 165265, 165317, 165320, 165321, 165315, 165314, 165318) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dcaIncompatibleMDS on (dcaIncompatibleMDS.patient_id = dca.patient_id and dcaIncompatibleMDS.encounter_id = dca.encounter_id) "
            + "					 union "
            + "					 select distinct bm.patient_id, bm.data_mdc,date_created, valueBM, bmEstado, bmIncompatibleMDS.valueIncBM,bmIncompatibleMDS.bmIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueBM, obsEstado.value_coded bmEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165264 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) bm "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncBM, obsEstado.value_coded bmIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (23724, 165265, 165176, 165318, 165319, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) bmIncompatibleMDS on (bmIncompatibleMDS.patient_id = bm.patient_id and bmIncompatibleMDS.encounter_id = bm.encounter_id) "
            + "					 union "
            + "					  select distinct cm.patient_id, cm.data_mdc,date_created, valueCM, cmEstado, cmIncompatibleMDS.valueIncCM,cmIncompatibleMDS.cmIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueCM, obsEstado.value_coded cmEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165265 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) cm "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncCM, obsEstado.value_coded cmIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165178, 165318, 165319, 165321, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) cmIncompatibleMDS on (cmIncompatibleMDS.patient_id = cm.patient_id and cmIncompatibleMDS.encounter_id = cm.encounter_id) "
            + "					 union "
            + "					  select distinct tb.patient_id, tb.data_mdc,date_created, valueTB, tbEstado, tbIncompatibleMDS.valueIncTB,tbIncompatibleMDS.tbIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueTB, obsEstado.value_coded tbEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165317 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) tb "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncTB, obsEstado.value_coded tbIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165318, 165319, 165320, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) tbIncompatibleMDS on (tbIncompatibleMDS.patient_id = tb.patient_id and tbIncompatibleMDS.encounter_id = tb.encounter_id) "
            + "					 union "
            + "					 select distinct ct.patient_id, ct.data_mdc,date_created, valueCT, ctEstado, ctIncompatibleMDS.valueIncCT,ctIncompatibleMDS.ctIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueCT, obsEstado.value_coded ctEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165318 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) ct "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncCT, obsEstado.value_coded ctIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165319) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) ctIncompatibleMDS on (ctIncompatibleMDS.patient_id = ct.patient_id and ctIncompatibleMDS.encounter_id = ct.encounter_id) "
            + "					 union "
            + "					  select distinct smi.patient_id, smi.data_mdc,date_created, valueSMI, smiEstado, smiIncompatibleMDS.valueIncSMI,smiIncompatibleMDS.smiIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueSMI, obsEstado.value_coded smiEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165320 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) smi "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncSMI, obsEstado.value_coded smiIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165318, 165319, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) smiIncompatibleMDS on (smiIncompatibleMDS.patient_id = smi.patient_id and smiIncompatibleMDS.encounter_id = smi.encounter_id) "
            + "					 union "
            + "					 select distinct dd.patient_id, dd.data_mdc,date_created, valueDD, ddEstado, ddIncompatibleMDS.valueIncDD,ddIncompatibleMDS.ddIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDD, obsEstado.value_coded ddEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165315 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dd "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDD, obsEstado.value_coded ddIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165321) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) ddIncompatibleMDS on (ddIncompatibleMDS.patient_id = dd.patient_id and ddIncompatibleMDS.encounter_id = dd.encounter_id) "
            + "					 union "
            + "					 select distinct da.patient_id, da.data_mdc,date_created, valueDA, daEstado, daIncompatibleMDS.valueIncDA,daIncompatibleMDS.daIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDA, obsEstado.value_coded daEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165314 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) da "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDA, obsEstado.value_coded daIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165318, 165321, 165315) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) daIncompatibleMDS on (daIncompatibleMDS.patient_id = da.patient_id and daIncompatibleMDS.encounter_id = da.encounter_id) "
            + "					 ) dsdFinal on dsdFinal.patient_id = patient.patient_id "
            + "					 group by dsdFinal.patient_id ";

    public static String getEc2Total =
        "    						select distinct patient.patient_id "
            + "                           from "
            + "                           ( "
            + "             				   select distinct patient.patient_id, patient_identifier.identifier from( "
            + "             select identifier  from patient_identifier pi "
            + "             	join patient on patient.patient_id = pi.patient_id "
            + "             where pi.voided = 0 and  pi.identifier_type =2 "
            + "             and patient.voided =0 "
            + "             group by pi.identifier  having count(*) >= 2 "
            + "             ) NID "
            + "             inner join patient_identifier on patient_identifier.identifier = NID.identifier "
            + "             inner join patient on patient.patient_id =patient_identifier.patient_id "
            + "             where patient.voided =0 and patient_identifier.voided =0  order by patient_identifier.identifier "
            + "             		     ) patientNID "
            + "                            inner join patient_identifier on patient_identifier.identifier = patientNID.identifier and patient_identifier.preferred = true "
            + "                            inner join patient on patient.patient_id =patient_identifier.patient_id "
            + "                            inner join person  on person.person_id =patient.patient_id "
            + "                            inner join person_name on person_name.person_id = patient.patient_id "
            + "                            left join location l on (l.location_id =patient_identifier.location_id and l.retired =0) "
            + "                            left join patient_program on (patient_program.patient_id = patient.patient_id and patient_program.program_id=2 and patient_program.voided =0) "
            + "					 LEFT JOIN (SELECT pg.patient_id, pg.date_enrolled, ps.state, max(ps.start_date) AS start_date "
            + "					 FROM patient_program pg "
            + "					 INNER JOIN patient_state ps ON pg.patient_program_id = ps.patient_program_id "
            + "					 AND ps.start_date IS NOT NULL "
            + "					 AND ps.end_date IS NULL "
            + "					 AND pg.program_id = 2 "
            + "					 GROUP BY pg.patient_id "
            + "					 ) AS programState  ON patient.patient_id = programState.patient_id "
            + "					 inner join ( "
            + "					 select distinct dt.patient_id, dt.data_mdc,date_created, valueDSD, estadoDSD, dtIncompatibleMDS.valueIncDSD,dtIncompatibleMDS.dsdIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDSD, obsEstado.value_coded estadoDSD from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 23730 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dt "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDSD, obsEstado.value_coded dsdIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165314, 23888, 23724, 165317, 165320, 165321) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dtIncompatibleMDS on (dtIncompatibleMDS.patient_id = dt.patient_id and dtIncompatibleMDS.encounter_id = dt.encounter_id) "
            + "					 union "
            + "					  select distinct ds.patient_id, ds.data_mdc,date_created, valueDS, dsEstado, dsIncompatibleMDS.valueIncDS,dsIncompatibleMDS.dsIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDS, obsEstado.value_coded dsEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 23888 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) ds "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDS, obsEstado.value_coded dsIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (23724, 165178, 165179, 165317, 165318, 165320, 165321, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dsIncompatibleMDS on (dsIncompatibleMDS.patient_id = ds.patient_id and dsIncompatibleMDS.encounter_id = ds.encounter_id) "
            + "					 union "
            + "					  select distinct ga.patient_id, ga.data_mdc,date_created, valueGA, gaEstado, gaIncompatibleMDS.valueIncGA,gaIncompatibleMDS.gaIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueGA, obsEstado.value_coded gaEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 23724 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) ga "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncGA, obsEstado.value_coded gaIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165178, 165179, 165265, 165317, 165320, 165321, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) gaIncompatibleMDS on (gaIncompatibleMDS.patient_id = ga.patient_id and gaIncompatibleMDS.encounter_id = ga.encounter_id) "
            + "					 union "
            + "					 select distinct dcp.patient_id, dcp.data_mdc,date_created, valueDCP, dcpEstado, dcpIncompatibleMDS.valueIncDCP,dcpIncompatibleMDS.dcpIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDCP, obsEstado.value_coded dcpEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165178 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257) and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dcp "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDCP, obsEstado.value_coded dcpIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165179, 165264, 165265, 165320, 165315, 165314, 165318) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dcpIncompatibleMDS on (dcpIncompatibleMDS.patient_id = dcp.patient_id and dcpIncompatibleMDS.encounter_id = dcp.encounter_id) "
            + "					 union "
            + "					 select distinct dca.patient_id, dca.data_mdc,date_created, valueDCA, dcaEstado, dcaIncompatibleMDS.valueIncDCA,dcaIncompatibleMDS.dcaIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDCA, obsEstado.value_coded dcaEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165179 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dca "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDCA, obsEstado.value_coded dcaIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165264, 165265, 165317, 165320, 165321, 165315, 165314, 165318) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dcaIncompatibleMDS on (dcaIncompatibleMDS.patient_id = dca.patient_id and dcaIncompatibleMDS.encounter_id = dca.encounter_id) "
            + "					 union "
            + "					 select distinct bm.patient_id, bm.data_mdc,date_created, valueBM, bmEstado, bmIncompatibleMDS.valueIncBM,bmIncompatibleMDS.bmIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueBM, obsEstado.value_coded bmEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165264 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) bm "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncBM, obsEstado.value_coded bmIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (23724, 165265, 165176, 165318, 165319, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) bmIncompatibleMDS on (bmIncompatibleMDS.patient_id = bm.patient_id and bmIncompatibleMDS.encounter_id = bm.encounter_id) "
            + "					 union "
            + "					  select distinct cm.patient_id, cm.data_mdc,date_created, valueCM, cmEstado, cmIncompatibleMDS.valueIncCM,cmIncompatibleMDS.cmIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueCM, obsEstado.value_coded cmEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165265 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) cm "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncCM, obsEstado.value_coded cmIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165178, 165318, 165319, 165321, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) cmIncompatibleMDS on (cmIncompatibleMDS.patient_id = cm.patient_id and cmIncompatibleMDS.encounter_id = cm.encounter_id) "
            + "					 union "
            + "					  select distinct tb.patient_id, tb.data_mdc,date_created, valueTB, tbEstado, tbIncompatibleMDS.valueIncTB,tbIncompatibleMDS.tbIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueTB, obsEstado.value_coded tbEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165317 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) tb "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncTB, obsEstado.value_coded tbIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165318, 165319, 165320, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) tbIncompatibleMDS on (tbIncompatibleMDS.patient_id = tb.patient_id and tbIncompatibleMDS.encounter_id = tb.encounter_id) "
            + "					 union "
            + "					 select distinct ct.patient_id, ct.data_mdc,date_created, valueCT, ctEstado, ctIncompatibleMDS.valueIncCT,ctIncompatibleMDS.ctIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueCT, obsEstado.value_coded ctEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165318 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) ct "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncCT, obsEstado.value_coded ctIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165319) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) ctIncompatibleMDS on (ctIncompatibleMDS.patient_id = ct.patient_id and ctIncompatibleMDS.encounter_id = ct.encounter_id) "
            + "					 union "
            + "					  select distinct smi.patient_id, smi.data_mdc,date_created, valueSMI, smiEstado, smiIncompatibleMDS.valueIncSMI,smiIncompatibleMDS.smiIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueSMI, obsEstado.value_coded smiEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165320 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) smi "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncSMI, obsEstado.value_coded smiIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165318, 165319, 165315, 165314) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) smiIncompatibleMDS on (smiIncompatibleMDS.patient_id = smi.patient_id and smiIncompatibleMDS.encounter_id = smi.encounter_id) "
            + "					 union "
            + "					 select distinct dd.patient_id, dd.data_mdc,date_created, valueDD, ddEstado, ddIncompatibleMDS.valueIncDD,ddIncompatibleMDS.ddIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDD, obsEstado.value_coded ddEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165315 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) dd "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDD, obsEstado.value_coded ddIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165321) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) ddIncompatibleMDS on (ddIncompatibleMDS.patient_id = dd.patient_id and ddIncompatibleMDS.encounter_id = dd.encounter_id) "
            + "					 union "
            + "					 select distinct da.patient_id, da.data_mdc,date_created, valueDA, daEstado, daIncompatibleMDS.valueIncDA,daIncompatibleMDS.daIncEstado from ( "
            + "					 select distinct p.patient_id, e.encounter_datetime as data_mdc, e.date_created, e.encounter_id,o.value_coded valueDA, obsEstado.value_coded daEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded = 165314 and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) da "
            + "					 inner join ( "
            + "						select p.patient_id, e.encounter_datetime as data_mdc, e.encounter_id, o.value_coded valueIncDA, obsEstado.value_coded daIncEstado from patient p "
            + "					join encounter e on p.patient_id=e.patient_id "
            + "					join obs grupo on grupo.encounter_id=e.encounter_id "
            + "					join obs o on o.encounter_id=e.encounter_id "
            + "					join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "					where  e.encounter_type = 35 and e.location_id=:location and o.concept_id=165174 and o.value_coded in (165318, 165321, 165315) and o.voided=0 "
            + "					and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in (1256, 1257)  and obsEstado.voided=0  and grupo.voided=0 "
            + "					and o.obs_group_id = obsEstado.obs_group_id "
            + "					and DATE(e.encounter_datetime) <= now() "
            + "					 ) daIncompatibleMDS on (daIncompatibleMDS.patient_id = da.patient_id and daIncompatibleMDS.encounter_id = da.encounter_id) "
            + "					 ) dsdFinal on dsdFinal.patient_id = patient.patient_id "
            + "					 group by dsdFinal.patient_id ";
  }
}
