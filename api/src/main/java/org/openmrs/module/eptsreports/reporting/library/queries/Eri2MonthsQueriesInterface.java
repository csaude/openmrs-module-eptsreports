package org.openmrs.module.eptsreports.reporting.library.queries;

public interface Eri2MonthsQueriesInterface {
  class QUERY {

    public static final String findPatientsWhoStartArtOneMonth =
        "SELECT patients.patient_id FROM ("
            + "SELECT patient_id, MIN(art_start_date) art_start_date FROM( "
            + "Select p.patient_id,min(e.encounter_datetime) art_start_date from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id	"
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.voided=0 and o.voided=0 and p.voided=0 and e.encounter_type in (18,6,9) and o.concept_id=1255 and o.value_coded=1256 and e.encounter_datetime<=:endDate and e.location_id=:location group by p.patient_id "
            + "union "
            + "Select p.patient_id,min(value_datetime) art_start_date from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (18,6,9,53) and  o.concept_id=1190 and o.value_datetime is not null and o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id "
            + "union select pg.patient_id,min(date_enrolled) art_start_date from patient p inner join patient_program pg on p.patient_id=pg.patient_id "
            + "where pg.voided=0 and p.voided=0 and program_id=2 and date_enrolled<=:endDate and location_id=:location group by pg.patient_id "
            + "union "
            + "SELECT e.patient_id, MIN(e.encounter_datetime) AS art_start_date  FROM patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "WHERE p.voided=0 and e.encounter_type=18 AND e.voided=0 and e.encounter_datetime<=:endDate and e.location_id=:location GROUP BY 	p.patient_id "
            + "union "
            + "Select p.patient_id,min(value_datetime) art_start_date from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and  o.concept_id=23866 and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id) patients_started_art "
            + "GROUP BY patients_started_art.patient_id "
            + "HAVING MIN(patients_started_art.art_start_date) BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH)) patients GROUP BY patients.patient_id";

    public static final String
        findPatientsStartedArtLastMonthWith2PickupsOrConsultationWithin33DaysExcludingDeadAndTransferedOutAndIn =
            "SELECT patients_all.patient_id FROM( "
                + "SELECT patients.patient_id, patients.art_start_date FROM ( "
                + "SELECT patient_id, MIN(art_start_date) art_start_date FROM( "
                + "Select  p.patient_id,min(e.encounter_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id  "
                + "inner join obs o on o.encounter_id=e.encounter_id where e.voided=0 and o.voided=0 and p.voided=0 and "
                + "e.encounter_type in (18,6,9) and o.concept_id=1255 and o.value_coded=1256 and  e.encounter_datetime<=:endDate and e.location_id=:location  group by p.patient_id "
                + "union "
                + " Select  p.patient_id,min(value_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id where   p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (18,6,9,53) and "
                + "o.concept_id=1190 and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "select  pg.patient_id,min(date_enrolled) art_start_date from patient p inner join patient_program pg on p.patient_id=pg.patient_id "
                + "where   pg.voided=0 and p.voided=0 and program_id=2 and date_enrolled<=:endDate and location_id=:location group by pg.patient_id "
                + "union "
                + "SELECT e.patient_id, MIN(e.encounter_datetime) AS art_start_date FROM patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "WHERE p.voided=0 and e.encounter_type=18 AND e.voided=0 and e.encounter_datetime<=:endDate and e.location_id=:location GROUP BY  p.patient_id "
                + "union "
                + "Select  p.patient_id,min(value_datetime) art_start_date from  patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where   p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and o.concept_id=23866 and o.value_datetime is not null and o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id   "
                + ") patients_started_art WHERE patients_started_art.patient_id NOT IN "
                + "(SELECT p.patient_id FROM patient p "
                + "INNER JOIN patient_program pg ON pg.patient_id = p.patient_id "
                + "INNER JOIN patient_state ps ON ps.patient_program_id = pg.patient_program_id "
                + "WHERE p.voided = 0 AND pg.voided = 0 AND ps.voided = 0 AND pg.program_id = 2 AND ps.state = 29 AND ps.start_date BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) AND pg.location_id = :location GROUP BY p.patient_id "
                + "union "
                + "Select  p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs obsTrans on e.encounter_id=obsTrans.encounter_id and obsTrans.voided=0 and obsTrans.concept_id=1369 and obsTrans.value_coded=1065 "
                + "inner join obs obsTarv on e.encounter_id=obsTarv.encounter_id and obsTarv.voided=0 and obsTarv.concept_id=6300 and obsTarv.value_coded=6276 "
                + "where p.voided=0 and e.voided=0 and e.encounter_type=53 and obsTrans.obs_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location"
                + ") GROUP BY patients_started_art.patient_id "
                + "HAVING MIN(patients_started_art.art_start_date) BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH)) patients "
                + "INNER JOIN ("
                + "select  p.patient_id, encounter_datetime from patient p  "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "where   p.voided=0 and e.voided=0 and "
                + "e.encounter_type in (6,9,18) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) and :endDate and e.location_id=:location "
                + "union "
                + "Select  p.patient_id,value_datetime as encounter_datetime from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where   p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and  o.concept_id=23866 and o.value_datetime is not null and "
                + "o.value_datetime between  (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) and :endDate and e.location_id=:location) lev_seg ON lev_seg.patient_id = patients.patient_id "
                + "WHERE lev_seg.encounter_datetime BETWEEN patients.art_start_date AND (patients.art_start_date + INTERVAL 33 DAY) AND patients.patient_id NOT IN ( "
                + "SELECT p.patient_id FROM patient p "
                + "INNER JOIN patient_program pg ON pg.patient_id = p.patient_id "
                + "INNER JOIN patient_state ps ON ps.patient_program_id = pg.patient_program_id "
                + "WHERE p.voided = 0 AND pg.voided = 0 AND ps.voided = 0 AND pg.program_id = 2 AND ps.state IN (7, 10) AND ps.start_date BETWEEN patients.art_start_date AND :endDate AND ps.end_date IS NULL AND pg.location_id = :location GROUP BY p.patient_id "
                + " union "
                + " select  p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs  o on e.encounter_id=o.encounter_id "
                + "where   e.voided=0 and o.voided=0 and p.voided=0 and "
                + "e.encounter_type=53 and o.concept_id=6272 and o.value_coded in (1706,1366) and "
                + "o.obs_datetime between patients.art_start_date AND :endDate and e.location_id=:location group by p.patient_id "
                + "union select person_id as patient_id from person  where dead=1 and death_date is not null and death_date between patients.art_start_date AND :endDate "
                + "union "
                + "select  p.patient_id from  patient p  "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs obsEncontrado on e.encounter_id=obsEncontrado.encounter_id "
                + "inner join obs obsObito on e.encounter_id=obsObito.encounter_id "
                + "where   e.voided=0 and obsEncontrado.voided=0 and p.voided=0 and obsObito.voided=0 and "
                + "e.encounter_type in (21,36,37) and  e.encounter_datetime between patients.art_start_date AND :endDate and  e.location_id=:location and "
                + "obsEncontrado.concept_id in (2003, 6348) and obsEncontrado.value_coded=1066 and obsObito.concept_id=2031 and obsObito.value_coded=1383 group by p.patient_id "
                + ") GROUP BY patients.patient_id HAVING MIN(lev_seg.encounter_datetime) < MAX(lev_seg.encounter_datetime) )patients_all GROUP BY patients_all.patient_id ";

    public static final String
        findPatientsWhoStartedArtAtAPeriodAndDidNotHaveASecondPickupsOrClinicalConsultationWithin33DaysAfterArtInitiation =
            "SELECT patients_all.patient_id FROM(SELECT patients.patient_id, patients.art_start_date FROM ("
                + "SELECT patient_id, MIN(art_start_date) art_start_date FROM( "
                + "Select p.patient_id,min(e.encounter_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id	"
                + "inner join obs o on o.encounter_id=e.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and e.encounter_type in (18,6,9) and o.concept_id=1255 and o.value_coded=1256 and e.encounter_datetime<=:endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "Select p.patient_id,min(value_datetime) art_start_date from 	patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (18,6,9,53) and o.concept_id=1190 and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "select pg.patient_id,min(date_enrolled) art_start_date from patient p "
                + "inner join patient_program pg on p.patient_id=pg.patient_id "
                + "where pg.voided=0 and p.voided=0 and program_id=2 and date_enrolled<=:endDate and location_id=:location group by pg.patient_id "
                + "union "
                + "SELECT e.patient_id, MIN(e.encounter_datetime) AS art_start_date  FROM patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "WHERE p.voided=0 and e.encounter_type=18 AND e.voided=0 and e.encounter_datetime<=:endDate and e.location_id=:location GROUP BY 	p.patient_id "
                + "union "
                + "Select p.patient_id,min(value_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and  o.concept_id=23866 and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id) patients_started_art "
                + "WHERE patients_started_art.patient_id NOT IN(SELECT p.patient_id FROM patient p "
                + "INNER JOIN patient_program pg ON pg.patient_id = p.patient_id "
                + "INNER JOIN patient_state ps ON ps.patient_program_id = pg.patient_program_id "
                + "WHERE p.voided = 0 AND pg.voided = 0 AND ps.voided = 0 AND pg.program_id = 2 AND ps.state = 29 AND ps.start_date BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) AND pg.location_id = :location GROUP BY p.patient_id "
                + "union Select p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs obsTrans on e.encounter_id=obsTrans.encounter_id and obsTrans.voided=0 and obsTrans.concept_id=1369 and obsTrans.value_coded=1065 "
                + "inner join obs obsTarv on e.encounter_id=obsTarv.encounter_id and obsTarv.voided=0 and obsTarv.concept_id=6300 and obsTarv.value_coded=6276 "
                + "where p.voided=0 and e.voided=0 and e.encounter_type=53 and obsTrans.obs_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location) GROUP BY patients_started_art.patient_id "
                + "HAVING MIN(patients_started_art.art_start_date) BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) "
                + ") patients "
                + "LEFT JOIN ( select p.patient_id,encounter_datetime from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "where p.voided=0 and e.voided=0 and e.encounter_type in (6,9,18) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) and :endDate and e.location_id=:location "
                + "union "
                + "Select p.patient_id,value_datetime as encounter_datetime "
                + "from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and o.concept_id=23866 and o.value_datetime is not null and o.value_datetime between  (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) and :endDate and e.location_id=:location) lev_seg ON lev_seg.patient_id = patients.patient_id and lev_seg.encounter_datetime BETWEEN patients.art_start_date AND (patients.art_start_date + INTERVAL 33 DAY) "
                + "WHERE patients.patient_id NOT IN ("
                + "SELECT p.patient_id FROM patient p "
                + "INNER JOIN patient_program pg ON pg.patient_id = p.patient_id "
                + "INNER JOIN patient_state ps ON ps.patient_program_id = pg.patient_program_id "
                + "WHERE p.voided = 0 AND pg.voided = 0 AND ps.voided = 0 AND pg.program_id = 2 AND ps.state IN (7, 10) AND ps.start_date BETWEEN patients.art_start_date AND :endDate AND ps.end_date IS NULL AND pg.location_id = :location GROUP BY p.patient_id "
                + "union "
                + "select p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs  o on e.encounter_id=o.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and e.encounter_type=53 and o.concept_id=6272 and o.value_coded in (1706,1366) and o.obs_datetime between patients.art_start_date AND :endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "select person_id as patient_id from person "
                + "where dead=1 and death_date is not null and death_date between patients.art_start_date AND :endDate "
                + "union select p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs obsEncontrado on e.encounter_id=obsEncontrado.encounter_id "
                + "inner join obs obsObito on e.encounter_id=obsObito.encounter_id "
                + "where e.voided=0 and obsEncontrado.voided=0 and p.voided=0 and obsObito.voided=0 and e.encounter_type in (21,36,37) and  e.encounter_datetime between patients.art_start_date AND :endDate and e.location_id=:location and obsEncontrado.concept_id in (2003, 6348) and obsEncontrado.value_coded=1066 and  obsObito.concept_id=2031 and obsObito.value_coded=1383 group by p.patient_id) GROUP BY patients.patient_id "
                + "HAVING MIN(lev_seg.encounter_datetime) = MAX(lev_seg.encounter_datetime) OR MIN(lev_seg.encounter_datetime) IS NULL )patients_all GROUP BY patients_all.patient_id ";

    public static final String
        findPatientsWhoStartedArtInAPeriodAndAreDeath33DaysAfterArtInitiation =
            "SELECT patients_all.patient_id FROM( "
                + "SELECT patients.patient_id, patients.art_start_date FROM( "
                + "SELECT patient_id, MIN(art_start_date) art_start_date FROM (Select p.patient_id,min(e.encounter_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on o.encounter_id=e.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and e.encounter_type in (18,6,9) and o.concept_id=1255 and o.value_coded=1256 and e.encounter_datetime<=:endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "Select p.patient_id,min(value_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (18,6,9,53) and  o.concept_id=1190 and o.value_datetime is not null and o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "select pg.patient_id,min(date_enrolled) art_start_date from patient p inner join patient_program pg on p.patient_id=pg.patient_id "
                + "where pg.voided=0 and p.voided=0 and program_id=2 and date_enrolled<=:endDate and location_id=:location group by pg.patient_id "
                + "union "
                + "SELECT 	e.patient_id, MIN(e.encounter_datetime) AS art_start_date FROM patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "WHERE p.voided=0 and e.encounter_type=18 AND e.voided=0 and e.encounter_datetime<=:endDate and e.location_id=:location GROUP BY 	p.patient_id "
                + "union "
                + "Select p.patient_id,min(value_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and  o.concept_id=23866 and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id)patients_started_art "
                + "WHERE patients_started_art.patient_id NOT IN ("
                + "SELECT p.patient_id FROM patient p "
                + "INNER JOIN patient_program pg ON pg.patient_id = p.patient_id "
                + "INNER JOIN patient_state ps ON ps.patient_program_id = pg.patient_program_id "
                + "WHERE p.voided = 0 AND pg.voided = 0 AND ps.voided = 0 AND pg.program_id = 2 AND ps.state = 29 AND ps.start_date BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) AND pg.location_id = :location GROUP BY p.patient_id "
                + "union "
                + "Select p.patient_id from 	patient p inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs obsTrans on e.encounter_id=obsTrans.encounter_id and obsTrans.voided=0 and obsTrans.concept_id=1369 and obsTrans.value_coded=1065 "
                + "inner join obs obsTarv on e.encounter_id=obsTarv.encounter_id and obsTarv.voided=0 and obsTarv.concept_id=6300 and obsTarv.value_coded=6276 "
                + "where p.voided=0 and e.voided=0 and e.encounter_type=53 and obsTrans.obs_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location) GROUP BY patients_started_art.patient_id "
                + "HAVING MIN(patients_started_art.art_start_date) BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH)) patients "
                + "INNER JOIN (SELECT p.patient_id FROM patient p "
                + "INNER JOIN patient_program pg ON pg.patient_id = p.patient_id "
                + "INNER JOIN patient_state ps ON ps.patient_program_id = pg.patient_program_id "
                + "WHERE p.voided = 0 AND pg.voided = 0 AND ps.voided = 0 AND pg.program_id = 2 AND ps.state=10 AND ps.start_date BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND :endDate AND ps.end_date IS NULL AND pg.location_id = :location GROUP BY p.patient_id "
                + "union "
                + "select 	p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs  o on e.encounter_id=o.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and e.encounter_type=53 and o.concept_id=6272 and o.value_coded=1366 and  o.obs_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND :endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "select person_id as patient_id from person "
                + "where dead=1 and death_date is not null and death_date between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND :endDate "
                + "union select p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs obsEncontrado on e.encounter_id=obsEncontrado.encounter_id "
                + "inner join obs obsObito on e.encounter_id=obsObito.encounter_id "
                + "where e.voided=0 and obsEncontrado.voided=0 and p.voided=0 and obsObito.voided=0 and e.encounter_type in (21,36,37) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND :endDate and  e.location_id=:location and obsEncontrado.concept_id in (2003, 6348) and obsEncontrado.value_coded=1066 and obsObito.concept_id=2031 and obsObito.value_coded=1383 group by p.patient_id) obito ON obito.patient_id = patients.patient_id GROUP BY patients.patient_id ) patients_all "
                + "GROUP BY patients_all.patient_id ";

    public static final String
        findPatientsWhoStartedArtInAPeriodAndSuspendTratement33DaysAfterInitiation =
            "SELECT patients_all.patient_id FROM( "
                + "SELECT patients.patient_id, patients.art_start_date FROM ( "
                + "SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
                + "Select p.patient_id,min(e.encounter_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on o.encounter_id=e.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and e.encounter_type in (18,6,9) and o.concept_id=1255 and o.value_coded=1256 and e.encounter_datetime<=:endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "Select p.patient_id,min(value_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (18,6,9,53) and o.concept_id=1190 and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "select pg.patient_id,min(date_enrolled) art_start_date from patient p inner join patient_program pg on p.patient_id=pg.patient_id "
                + "where pg.voided=0 and p.voided=0 and program_id=2 and date_enrolled<=:endDate and location_id=:location group by pg.patient_id "
                + "union "
                + "SELECT e.patient_id, MIN(e.encounter_datetime) AS art_start_date  FROM patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "WHERE p.voided=0 and e.encounter_type=18 AND e.voided=0 and e.encounter_datetime<=:endDate and e.location_id=:location GROUP BY 	p.patient_id "
                + "union "
                + "Select p.patient_id,min(value_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and  o.concept_id=23866 and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id) patients_started_art "
                + "WHERE patients_started_art.patient_id NOT IN("
                + "SELECT p.patient_id FROM patient p "
                + "INNER JOIN patient_program pg ON pg.patient_id = p.patient_id "
                + "INNER JOIN patient_state ps ON ps.patient_program_id = pg.patient_program_id "
                + "WHERE p.voided = 0 AND pg.voided = 0 AND ps.voided = 0 AND pg.program_id = 2 AND ps.state = 29 AND ps.start_date BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) AND pg.location_id = :location GROUP BY p.patient_id "
                + "union "
                + "Select 	p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs obsTrans on e.encounter_id=obsTrans.encounter_id and obsTrans.voided=0 and obsTrans.concept_id=1369 and obsTrans.value_coded=1065 "
                + "inner join obs obsTarv on e.encounter_id=obsTarv.encounter_id and obsTarv.voided=0 and obsTarv.concept_id=6300 and obsTarv.value_coded=6276  "
                + "where p.voided=0 and e.voided=0 and e.encounter_type=53 and obsTrans.obs_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location) GROUP BY patients_started_art.patient_id "
                + "HAVING MIN(patients_started_art.art_start_date) BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH)) patients "
                + "INNER JOIN ( "
                + "SELECT p.patient_id FROM patient p "
                + "INNER JOIN patient_program pg ON pg.patient_id = p.patient_id "
                + "INNER JOIN patient_state ps ON ps.patient_program_id = pg.patient_program_id "
                + "WHERE p.voided = 0 AND pg.voided = 0 AND ps.voided = 0 AND pg.program_id = 2 AND ps.state=8 AND ps.start_date BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND :endDate AND ps.end_date IS NULL AND pg.location_id = :location GROUP BY p.patient_id "
                + "union select p.patient_id from patient p  "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs  o on e.encounter_id=o.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and e.encounter_type=53 and o.concept_id=6272 and o.value_coded=1709 and  o.obs_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND :endDate and e.location_id=:location group by p.patient_id) suspenso ON suspenso.patient_id = patients.patient_id GROUP BY patients.patient_id ) patients_all GROUP BY patients_all.patient_id ";

    public static final String
        findPatientsWhoStartedArtInAPeriodAndAreTrasferedOut33DaysAfterInitiation =
            "SELECT patients_all.patient_id FROM ("
                + "SELECT patients.patient_id, patients.art_start_date FROM( "
                + "SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
                + "Select p.patient_id,min(e.encounter_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id	"
                + "inner join obs o on o.encounter_id=e.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and  e.encounter_type in (18,6,9) and o.concept_id=1255 and o.value_coded=1256 and  e.encounter_datetime<=:endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "Select p.patient_id,min(value_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (18,6,9,53) and o.concept_id=1190 and o.value_datetime is not null and o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id "
                + "union "
                + "select pg.patient_id,min(date_enrolled) art_start_date from patient p inner join patient_program pg on p.patient_id=pg.patient_id "
                + "where pg.voided=0 and p.voided=0 and program_id=2 and date_enrolled<=:endDate and location_id=:location group by pg.patient_id "
                + "union "
                + "SELECT e.patient_id, MIN(e.encounter_datetime) AS art_start_date  FROM patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "WHERE p.voided=0 and e.encounter_type=18 AND e.voided=0 and e.encounter_datetime<=:endDate and e.location_id=:location GROUP BY p.patient_id "
                + "union select p.patient_id,min(value_datetime) art_start_date from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and o.concept_id=23866 and o.value_datetime is not null and o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id) patients_started_art "
                + "WHERE patients_started_art.patient_id NOT IN( "
                + "SELECT p.patient_id FROM patient p "
                + "INNER JOIN patient_program pg ON pg.patient_id = p.patient_id "
                + "INNER JOIN patient_state ps ON ps.patient_program_id = pg.patient_program_id "
                + "WHERE p.voided = 0 AND pg.voided = 0 AND ps.voided = 0 AND pg.program_id = 2 AND ps.state = 29 AND ps.start_date BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) AND pg.location_id = :location GROUP BY p.patient_id "
                + "union "
                + "Select p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs obsTrans on e.encounter_id=obsTrans.encounter_id and obsTrans.voided=0 and obsTrans.concept_id=1369 and obsTrans.value_coded=1065 "
                + "inner join obs obsTarv on e.encounter_id=obsTarv.encounter_id and obsTarv.voided=0 and obsTarv.concept_id=6300 and obsTarv.value_coded=6276 "
                + "where p.voided=0 and e.voided=0 and e.encounter_type=53 and obsTrans.obs_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location) GROUP BY patients_started_art.patient_id "
                + "HAVING MIN(patients_started_art.art_start_date) BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH)) patients "
                + "INNER JOIN ( "
                + "SELECT p.patient_id FROM patient p "
                + "INNER JOIN patient_program pg ON pg.patient_id = p.patient_id "
                + "INNER JOIN patient_state ps ON ps.patient_program_id = pg.patient_program_id "
                + "WHERE p.voided = 0 AND pg.voided = 0 AND ps.voided = 0 AND pg.program_id = 2 AND ps.state=7 AND ps.start_date BETWEEN (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND :endDate AND ps.end_date IS NULL AND pg.location_id = :location GROUP BY p.patient_id "
                + "union "
                + "select p.patient_id from patient p  "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs  o on e.encounter_id=o.encounter_id "
                + "where e.voided=0 and o.voided=0 and p.voided=0 and  e.encounter_type=53 and o.concept_id=6272 and o.value_coded=1706 and o.obs_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND :endDate and e.location_id=:location group by p.patient_id ) transferido ON transferido.patient_id = patients.patient_id GROUP BY patients.patient_id) patients_all GROUP BY patients_all.patient_id ";

    public static final String
        patientsThatAreFemaleAndWereMarkedAsPregnantInTheInitialConsultationOrFollowUpConsultationAndMasterCard =
            "select patient_id from ( "
                + "Select p.patient_id from patient p  "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=1982 and value_coded in (44,1465) and  e.encounter_type in (5,6) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + "union "
                + "Select p.patient_id from patient p inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=1279 and  e.encounter_type in (5,6) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + "union "
                + "Select p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=1600 and e.encounter_type in (5,6) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + "union "
                + "Select p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=6334 and value_coded=6331 and  e.encounter_type in (5,6) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + "union "
                + "select pp.patient_id from patient_program pp  where 	pp.program_id=8 and pp.voided=0 and  pp.date_enrolled between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and pp.location_id=:location "
                + "union "
                + "Select p.patient_id from patient p inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and o.concept_id=5272 and o.value_coded=1065 and  e.encounter_type=53 and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + "union "
                + "Select p.patient_id from patient p inner join encounter e on p.patient_id=e.patient_id inner join obs o on e.encounter_id=o.encounter_id where p.voided=0 and e.voided=0 and o.voided=0 and o.concept_id=1465 and  e.encounter_type=6 and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + ") gravida inner join person p on p.person_id=gravida.patient_id where p.gender='F' ";

    public static final String
        patientsThatAreFemaleAndWereMarkedAsBrestfeetingInTheInitialConsultationOrFollowUpConsultationAndMasterCard =
            "select lactante_real.patient_id from ( "
                + "Select p.patient_id,o.value_datetime data_parto from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=5599 and  e.encounter_type in (5,6) and o.value_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location	"
                + "union "
                + "Select p.patient_id, e.encounter_datetime data_parto from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=6332 and value_coded=1065 and  e.encounter_type in (6,53) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + "union "
                + "Select p.patient_id, e.encounter_datetime data_parto from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=6334 and value_coded=6332 and  e.encounter_type in (5,6) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + "union "
                + "select pg.patient_id,ps.start_date data_parto from patient p "
                + "inner join patient_program pg on p.patient_id=pg.patient_id "
                + "inner join patient_state ps on pg.patient_program_id=ps.patient_program_id "
                + "where pg.voided=0 and ps.voided=0 and p.voided=0 and  pg.program_id=8 and ps.state=27 and ps.end_date is null and  ps.start_date between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and location_id=:location) lactante_real "
                + "inner join person on lactante_real.patient_id=person.person_id "
                + "where person.gender='F' and  lactante_real.patient_id not in ( "
                + "select patient_id from ( "
                + "Select p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=1982 and value_coded in (44,1465) and  e.encounter_type in (5,6) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + "union "
                + "Select p.patient_id from patient p inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=1279 and  e.encounter_type in (5,6) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + "union "
                + "Select p.patient_id from patient p inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=1600 and  e.encounter_type in (5,6) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location	 "
                + "union Select p.patient_id from 	patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=6334 and value_coded=6331 and e.encounter_type in (5,6) and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location	"
                + "union "
                + "select pp.patient_id from patient_program pp "
                + "where pp.program_id=8 and pp.voided=0 and  pp.date_enrolled between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and pp.location_id=:location "
                + "union "
                + "Select p.patient_id from patient p inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and o.concept_id=5272 and o.value_coded=1065 and  e.encounter_type=53 and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + "union "
                + "Select p.patient_id from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and o.concept_id=1465 and  e.encounter_type=6 and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location "
                + ") gravida "
                + "inner join person p on p.person_id=gravida.patient_id "
                + "where p.gender='F') ";

    public static final String patientsThatAreAdult =
        "select patient_id from ( "
            + "select patient_id,min(data_inicio) data_inicio from( "
            + "Select p.patient_id,min(e.encounter_datetime) data_inicio from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.voided=0 and o.voided=0 and p.voided=0 and  e.encounter_type in (18,6,9) and o.concept_id=1255 and o.value_coded=1256 and  e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location group by p.patient_id "
            + "union "
            + "Select p.patient_id,min(value_datetime) data_inicio from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (18,6,9,53) and o.concept_id=1190 and o.value_datetime is not null and  o.value_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location group by p.patient_id "
            + "union "
            + "select pg.patient_id,min(date_enrolled) data_inicio from patient p "
            + "inner join patient_program pg on p.patient_id=pg.patient_id "
            + "where pg.voided=0 and p.voided=0 and program_id=2 and date_enrolled between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and location_id=:location group by pg.patient_id "
            + "union "
            + "SELECT e.patient_id, MIN(e.encounter_datetime) AS data_inicio  FROM patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "WHERE p.voided=0 and e.encounter_type=18 AND e.voided=0 and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location GROUP BY 	p.patient_id "
            + "union Select p.patient_id,min(value_datetime) data_inicio from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and  o.concept_id=23866 and o.value_datetime is not null and  o.value_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location group by p.patient_id) inicio group by patient_id )inicio_real "
            + "inner join person pe on inicio_real.patient_id=pe.person_id "
            + "where timestampdiff(year,birthdate,data_inicio)>=15 and birthdate is not null ";

    public static final String patientsThatAreChild =
        "select patient_id from ( "
            + "select patient_id,min(data_inicio) data_inicio from ( "
            + "Select p.patient_id,min(e.encounter_datetime) data_inicio from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.voided=0 and o.voided=0 and p.voided=0 and  e.encounter_type in (18,6,9) and o.concept_id=1255 and o.value_coded=1256 and  e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location group by p.patient_id "
            + "union "
            + "Select p.patient_id,min(value_datetime) data_inicio from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (18,6,9,53) and  o.concept_id=1190 and o.value_datetime is not null and o.value_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location group by p.patient_id "
            + "union "
            + "select pg.patient_id,min(date_enrolled) data_inicio from patient p inner join patient_program pg on p.patient_id=pg.patient_id "
            + "where pg.voided=0 and p.voided=0 and program_id=2 and date_enrolled between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and location_id=:location group by pg.patient_id "
            + "union "
            + "SELECT e.patient_id, MIN(e.encounter_datetime) AS data_inicio  FROM patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "WHERE p.voided=0 and e.encounter_type=18 AND e.voided=0 and e.encounter_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location GROUP BY p.patient_id "
            + "union "
            + "Select 	p.patient_id,min(value_datetime) data_inicio from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and  o.concept_id=23866 and o.value_datetime is not null and  o.value_datetime between (:endDate - INTERVAL 2 MONTH + INTERVAL 1 DAY) AND (:endDate - INTERVAL  1 MONTH) and e.location_id=:location group by p.patient_id) inicio group by patient_id "
            + ")inicio_real inner join person pe on inicio_real.patient_id=pe.person_id where timestampdiff(year,birthdate,data_inicio)<=14 and birthdate is not null";
  }
}
